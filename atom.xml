<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Continuous Learning</title>
  <subtitle>浮云一别后，流水十年间</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://blog.decbug.com/"/>
  <updated>2016-06-29T13:21:22.619Z</updated>
  <id>http://blog.decbug.com/</id>
  
  <author>
    <name>CodeJuan</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>kubernetes自定义admission插件</title>
    <link href="http://blog.decbug.com/2016/06/28/k8s_admission/"/>
    <id>http://blog.decbug.com/2016/06/28/k8s_admission/</id>
    <published>2016-06-27T16:00:00.000Z</published>
    <updated>2016-06-29T13:21:22.619Z</updated>
    
    <content type="html">&lt;h1 id=&quot;背景&quot;&gt;&lt;a href=&quot;#背景&quot; class=&quot;headerlink&quot; title=&quot;背景&quot;&gt;&lt;/a&gt;背景&lt;/h1&gt;&lt;h2 id=&quot;quota&quot;&gt;&lt;a href=&quot;#quota&quot; class=&quot;headerlink&quot; title=&quot;quota&quot;&gt;&lt;/a&gt;quota&lt;/h2&gt;&lt;p&gt;k8s的resourcequota的粒度太粗，只能针对namespace级进行quota。&lt;br&gt;为了实现更细粒度的quota，有必要自制一个admission插件。&lt;/p&gt;
&lt;h2 id=&quot;ABAC&quot;&gt;&lt;a href=&quot;#ABAC&quot; class=&quot;headerlink&quot; title=&quot;ABAC&quot;&gt;&lt;/a&gt;ABAC&lt;/h2&gt;&lt;p&gt;由于ABAC是在api server启动的时候载入，如果有修改，就必须重启api server才能生效。所以我想做个动态ABAC插件，把权限信息保存到etcd&lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;h1 id=&quot;分析源码&quot;&gt;&lt;a href=&quot;#分析源码&quot; class=&quot;headerlink&quot; title=&quot;分析源码&quot;&gt;&lt;/a&gt;分析源码&lt;/h1&gt;&lt;p&gt;代码在plugin/pkg/admission，已有admit, deny, resourcequota等插件。&lt;br&gt;有两个函数需要重点关注&lt;/p&gt;
&lt;h2 id=&quot;init&quot;&gt;&lt;a href=&quot;#init&quot; class=&quot;headerlink&quot; title=&quot;init&quot;&gt;&lt;/a&gt;init&lt;/h2&gt;&lt;figure class=&quot;highlight autoit&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;init&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	admission.RegisterPlugin(&lt;span class=&quot;string&quot;&gt;&quot;AlwaysAdmit&quot;&lt;/span&gt;, &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;func&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(client clientset.Interface, config io.Reader)&lt;/span&gt; &lt;span class=&quot;params&quot;&gt;(admission.Interface, error)&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; NewAlwaysAdmit(), nil&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#125;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;注册&lt;code&gt;AlwaysAdmit&lt;/code&gt;，返回值是&lt;code&gt;admission.Interface&lt;/code&gt;，注意看admit函数&lt;/p&gt;
&lt;h2 id=&quot;admit&quot;&gt;&lt;a href=&quot;#admit&quot; class=&quot;headerlink&quot; title=&quot;admit&quot;&gt;&lt;/a&gt;admit&lt;/h2&gt;&lt;figure class=&quot;highlight autoit&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;params&quot;&gt;(alwaysAdmit)&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Admit&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(a admission.Attributes)&lt;/span&gt; &lt;span class=&quot;params&quot;&gt;(err error)&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; nil&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h1 id=&quot;自定义插件&quot;&gt;&lt;a href=&quot;#自定义插件&quot; class=&quot;headerlink&quot; title=&quot;自定义插件&quot;&gt;&lt;/a&gt;自定义插件&lt;/h1&gt;&lt;p&gt;也要实现一个init，用于注册及返回Interface。然后完成admit函数&lt;br&gt;&lt;figure class=&quot;highlight autoit&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;params&quot;&gt;(l *myadmission)&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Admit&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(a admission.Attributes)&lt;/span&gt; &lt;span class=&quot;params&quot;&gt;(err error)&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    // 加上我的判断逻辑&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; allow &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; nil&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; admission.NewForbidden()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;&lt;code&gt;本博客欢迎转发,但请保留原作者信息&lt;/code&gt;&lt;br&gt;github:&lt;a href=&quot;https://github.com/CodeJuan&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;codejuan&lt;/a&gt;&lt;br&gt;博客地址:&lt;a href=&quot;http://blog.decbug.com/&quot;&gt;http://blog.decbug.com/&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;背景&quot;&gt;&lt;a href=&quot;#背景&quot; class=&quot;headerlink&quot; title=&quot;背景&quot;&gt;&lt;/a&gt;背景&lt;/h1&gt;&lt;h2 id=&quot;quota&quot;&gt;&lt;a href=&quot;#quota&quot; class=&quot;headerlink&quot; title=&quot;quota&quot;&gt;&lt;/a&gt;quota&lt;/h2&gt;&lt;p&gt;k8s的resourcequota的粒度太粗，只能针对namespace级进行quota。&lt;br&gt;为了实现更细粒度的quota，有必要自制一个admission插件。&lt;/p&gt;
&lt;h2 id=&quot;ABAC&quot;&gt;&lt;a href=&quot;#ABAC&quot; class=&quot;headerlink&quot; title=&quot;ABAC&quot;&gt;&lt;/a&gt;ABAC&lt;/h2&gt;&lt;p&gt;由于ABAC是在api server启动的时候载入，如果有修改，就必须重启api server才能生效。所以我想做个动态ABAC插件，把权限信息保存到etcd&lt;/p&gt;
    
    </summary>
    
      <category term="code" scheme="http://blog.decbug.com/categories/code/"/>
    
    
      <category term="docker" scheme="http://blog.decbug.com/tags/docker/"/>
    
      <category term="kubernetes" scheme="http://blog.decbug.com/tags/kubernetes/"/>
    
  </entry>
  
  <entry>
    <title>plantuml</title>
    <link href="http://blog.decbug.com/2016/06/27/plantuml/"/>
    <id>http://blog.decbug.com/2016/06/27/plantuml/</id>
    <published>2016-06-26T16:00:00.000Z</published>
    <updated>2016-06-29T13:21:22.619Z</updated>
    
    <content type="html">&lt;h1 id=&quot;概念&quot;&gt;&lt;a href=&quot;#概念&quot; class=&quot;headerlink&quot; title=&quot;概念&quot;&gt;&lt;/a&gt;概念&lt;/h1&gt;&lt;p&gt;架构图即代码&lt;br&gt;PlantUML is a open-source tool that allows to quickly write :&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Sequence diagram,&lt;/li&gt;
&lt;li&gt;Usecase diagram,&lt;/li&gt;
&lt;li&gt;Class diagram,&lt;/li&gt;
&lt;li&gt;Activity diagram, (here is the new syntax),&lt;/li&gt;
&lt;li&gt;Component diagram,&lt;/li&gt;
&lt;li&gt;State diagram,&lt;/li&gt;
&lt;li&gt;Deployment diagram,&lt;/li&gt;
&lt;li&gt;Object diagram.&lt;/li&gt;
&lt;li&gt;wireframe graphical interface&lt;/li&gt;
&lt;/ul&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;h1 id=&quot;效果&quot;&gt;&lt;a href=&quot;#效果&quot; class=&quot;headerlink&quot; title=&quot;效果&quot;&gt;&lt;/a&gt;效果&lt;/h1&gt;&lt;img src=&quot;http://www.plantuml.com/plantuml/svg/NOyn3i8m34NtdEAhKplGeMC7f1w0Bi36uhQ61gLEbKI8uvEa5KX8KVBz_6t7xOcqe9iMBIt8RqgLLyy8CuFMrUYHWhPIfNHAL4h5s-5mH7aEv4Arnmbi-TmbWXyH6nXEF-O0Uz-ceCLbrXxna83VjAo6wt_hLWzqo7oCLZBUHZ8mhC3pYnqP62ti5SkKVNkN8W_8ChwZ5U4ny7IJOB-5TdX6wEiYxTStQjy9TPsYlaaYV-83&quot;&gt;
&lt;img src=&quot;http://www.plantuml.com/plantuml/svg/ROyz2y8m48Rt_8eZUmVHMH2nkeX2knM7s4HRR7CnIS4Y_U_cez1IX0p7lPVdkLEiVB6d09fXA-2eiLCKlWJWbETNIA18QsqixB5LA8MqDnSLEucs4dhU7GYHo1td4f80Cf6KHb0cIfHyGLhI8Kcs_eFdbGrsF12AmuUrgX6m2YB2cMLtPfpjt6Vl9ceUs71dfdbL6t2lxSTMZBqiJgozUV0_D7CtqnHn6WcjJPpmgZ-tXXtdAytgc4sYgHoJaVy3&quot;&gt;
&lt;img src=&quot;http://www.plantuml.com/plantuml/svg/JOon2iCm34HtVuNGb0Jo2u4C7JgtcybWKZaMf7AnbKBxzRM9Xsx7UtVN3JsCumHu5LPsEt-TSXGqXZtWBJu9xfGLGGE9WTgrcWvQcfnNvJVh1qy7E4iirGJkNoJUWXRR3RsXFLDba_Mkn7QaWMM3wjgJlSYZebUAA-MydDl2_0y0&quot;&gt;
&lt;h1 id=&quot;在hexo博客加上plantuml插件&quot;&gt;&lt;a href=&quot;#在hexo博客加上plantuml插件&quot; class=&quot;headerlink&quot; title=&quot;在hexo博客加上plantuml插件&quot;&gt;&lt;/a&gt;在hexo博客加上plantuml插件&lt;/h1&gt;&lt;h2 id=&quot;install&quot;&gt;&lt;a href=&quot;#install&quot; class=&quot;headerlink&quot; title=&quot;install&quot;&gt;&lt;/a&gt;install&lt;/h2&gt;&lt;figure class=&quot;highlight sql&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;npm &lt;span class=&quot;operator&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;install&lt;/span&gt; hexo-tag-plantuml &lt;span class=&quot;comment&quot;&gt;--save&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;add-to-config-yml&quot;&gt;&lt;a href=&quot;#add-to-config-yml&quot; class=&quot;headerlink&quot; title=&quot;add to _config.yml&quot;&gt;&lt;/a&gt;add to _config.yml&lt;/h2&gt;&lt;p&gt;And add this plugin in _config.yml.&lt;br&gt;&lt;figure class=&quot;highlight vim&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;plugin&lt;span class=&quot;variable&quot;&gt;s:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; - hexo-&lt;span class=&quot;keyword&quot;&gt;tag&lt;/span&gt;-plantuml&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h2 id=&quot;test&quot;&gt;&lt;a href=&quot;#test&quot; class=&quot;headerlink&quot; title=&quot;test&quot;&gt;&lt;/a&gt;test&lt;/h2&gt;&lt;h3 id=&quot;add-text-to-markdown-file&quot;&gt;&lt;a href=&quot;#add-text-to-markdown-file&quot; class=&quot;headerlink&quot; title=&quot;add text to markdown file&quot;&gt;&lt;/a&gt;add text to markdown file&lt;/h3&gt;&lt;figure class=&quot;highlight erlang-repl&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;span class=&quot;comment&quot;&gt;% plantuml %&amp;#125;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;variable&quot;&gt;Bob&lt;/span&gt;&lt;span class=&quot;arrow&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;variable&quot;&gt;Alice&lt;/span&gt; : &lt;span class=&quot;function_or_atom&quot;&gt;hello&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;span class=&quot;comment&quot;&gt;% endplantuml %&amp;#125;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;test-1&quot;&gt;&lt;a href=&quot;#test-1&quot; class=&quot;headerlink&quot; title=&quot;test&quot;&gt;&lt;/a&gt;test&lt;/h3&gt;&lt;figure class=&quot;highlight axapta&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;hexo clean &amp;amp;&amp;amp; hexo generate &amp;amp;&amp;amp; hexo &lt;span class=&quot;keyword&quot;&gt;server&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;效果-1&quot;&gt;&lt;a href=&quot;#效果-1&quot; class=&quot;headerlink&quot; title=&quot;效果&quot;&gt;&lt;/a&gt;效果&lt;/h3&gt;&lt;img src=&quot;http://www.plantuml.com/plantuml/svg/SyfFqhLppCbCJbMmKiX8pSd91m00&quot;&gt;
&lt;h1 id=&quot;公司内网搭建plantuml服务&quot;&gt;&lt;a href=&quot;#公司内网搭建plantuml服务&quot; class=&quot;headerlink&quot; title=&quot;公司内网搭建plantuml服务&quot;&gt;&lt;/a&gt;公司内网搭建plantuml服务&lt;/h1&gt;&lt;p&gt;虽然&lt;a href=&quot;http://plantuml.com/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://plantuml.com/&lt;/a&gt;提供了online server，但是由于信息安全问题，不能直接把代码贴到那生成图片，所以需要自己在内网建一个.&lt;/p&gt;
&lt;h2 id=&quot;选型&quot;&gt;&lt;a href=&quot;#选型&quot; class=&quot;headerlink&quot; title=&quot;选型&quot;&gt;&lt;/a&gt;选型&lt;/h2&gt;&lt;p&gt;其实也没啥选的，由于linux机器都被回收，只有自己用的windows办公机，所以只能用windows了。&lt;br&gt;前端用bootstrap+angularjs，好吧，我承认我是前端小白，其实我就只会这哥俩&lt;br&gt;后端就用go的gin框架，原因就是之前用gin写了个玩具，基本可以复用&lt;/p&gt;
&lt;h2 id=&quot;准备工作&quot;&gt;&lt;a href=&quot;#准备工作&quot; class=&quot;headerlink&quot; title=&quot;准备工作&quot;&gt;&lt;/a&gt;准备工作&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;plantuml需要jdk&lt;/li&gt;
&lt;li&gt;下载plantuml.jar，进入&lt;a href=&quot;http://plantuml.com/download.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://plantuml.com/download.html&lt;/a&gt;，下载last version，&lt;a href=&quot;http://sourceforge.net/projects/plantuml/files/plantuml.jar/download&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://sourceforge.net/projects/plantuml/files/plantuml.jar/download&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;由于plantuml在生成图片时会用到graphviz，也需要一并下载并安装&lt;a href=&quot;http://www.graphviz.org/Download_windows.php&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://www.graphviz.org/Download_windows.php&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;plantuml会调用graphviz的dot.exe，所以需要增加环境变量&lt;strong&gt;GRAPHVIZ_DOT&lt;/strong&gt;，值就是dot.exe的全路径&lt;/li&gt;
&lt;li&gt;&lt;code&gt;java -jar plantuml.jar -testdot&lt;/code&gt;，如果返回OK，那么说明安装成功&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;实现过程&quot;&gt;&lt;a href=&quot;#实现过程&quot; class=&quot;headerlink&quot; title=&quot;实现过程&quot;&gt;&lt;/a&gt;实现过程&lt;/h2&gt;&lt;h3 id=&quot;启动plantuml&quot;&gt;&lt;a href=&quot;#启动plantuml&quot; class=&quot;headerlink&quot; title=&quot;启动plantuml&quot;&gt;&lt;/a&gt;启动plantuml&lt;/h3&gt;&lt;figure class=&quot;highlight css&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;java&lt;/span&gt; &lt;span class=&quot;tag&quot;&gt;-jar&lt;/span&gt; &lt;span class=&quot;tag&quot;&gt;plantuml&lt;/span&gt;&lt;span class=&quot;class&quot;&gt;.jar&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;会监控当前目录，如果有&lt;code&gt;.txt等文件&lt;/code&gt;的变更，就会生成同名的png&lt;/p&gt;
&lt;h3 id=&quot;时序图&quot;&gt;&lt;a href=&quot;#时序图&quot; class=&quot;headerlink&quot; title=&quot;时序图&quot;&gt;&lt;/a&gt;时序图&lt;/h3&gt;&lt;img src=&quot;http://www.plantuml.com/plantuml/svg/JOz92i9044NtEKKkq1TmaRi8WWXHH19mgI0unmGqY37EeYWE6mUCmsMwkitAArX9QtHLHV7h_V-XskJh7L70D73ACHbQbbyePjLuHjFJAk-Lg3Vbew8a14JXZiMC1NUsSEkWdBU7h69IRwxhgGHODp2R-AFbDMQNgNTyNHlquSAc2w4FlOwOEu-WKDcppKmefNymKRu1qEAxicc17Uh1Zxs7oI0oU9PNK5kA860sC44savGY026A_6iNBX49XHWcYDTV1YJZ12rR70KUOP_cWXEsGCxpqGPd83o5Ni-fI63TEvzTaEoF3xuxeUVQ6m00&quot;&gt;
&lt;p&gt;期间有个比较蛋疼的事，由于golang的string是UTF8，保存到文件也是UTF8，plantuml不识别，总提示语法错误。解决方法:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;参考&lt;a href=&quot;http://mengqi.info/html/2015/201507071345-using-golang-to-convert-text-between-gbk-and-utf-8.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://mengqi.info/html/2015/201507071345-using-golang-to-convert-text-between-gbk-and-utf-8.html&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;将string转换成gbk的bytes，然后写入到文件&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;炫耀&quot;&gt;&lt;a href=&quot;#炫耀&quot; class=&quot;headerlink&quot; title=&quot;炫耀&quot;&gt;&lt;/a&gt;炫耀&lt;/h2&gt;&lt;p&gt;花了3个小时搞定，就推荐给周围同事，得到一致好评，大家都可以抛弃visio等图形化工具了。&lt;br&gt;通过markdown实现了&lt;strong&gt;设计文档即代码&lt;/strong&gt;&lt;br&gt;那么通过plantuml实现了&lt;strong&gt;架构图即代码&lt;/strong&gt;&lt;br&gt;文本化，可以版本管理&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;&lt;code&gt;本博客欢迎转发,但请保留原作者信息&lt;/code&gt;&lt;br&gt;github:&lt;a href=&quot;https://github.com/CodeJuan&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;codejuan&lt;/a&gt;&lt;br&gt;博客地址:&lt;a href=&quot;http://blog.decbug.com/&quot;&gt;http://blog.decbug.com/&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;概念&quot;&gt;&lt;a href=&quot;#概念&quot; class=&quot;headerlink&quot; title=&quot;概念&quot;&gt;&lt;/a&gt;概念&lt;/h1&gt;&lt;p&gt;架构图即代码&lt;br&gt;PlantUML is a open-source tool that allows to quickly write :&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Sequence diagram,&lt;/li&gt;
&lt;li&gt;Usecase diagram,&lt;/li&gt;
&lt;li&gt;Class diagram,&lt;/li&gt;
&lt;li&gt;Activity diagram, (here is the new syntax),&lt;/li&gt;
&lt;li&gt;Component diagram,&lt;/li&gt;
&lt;li&gt;State diagram,&lt;/li&gt;
&lt;li&gt;Deployment diagram,&lt;/li&gt;
&lt;li&gt;Object diagram.&lt;/li&gt;
&lt;li&gt;wireframe graphical interface&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="code" scheme="http://blog.decbug.com/categories/code/"/>
    
    
      <category term="diagram" scheme="http://blog.decbug.com/tags/diagram/"/>
    
  </entry>
  
  <entry>
    <title>flannel与overlay</title>
    <link href="http://blog.decbug.com/2016/06/23/flannel/"/>
    <id>http://blog.decbug.com/2016/06/23/flannel/</id>
    <published>2016-06-22T16:00:00.000Z</published>
    <updated>2016-06-29T13:21:22.619Z</updated>
    
    <content type="html">&lt;p&gt;正在搞docker与neutron融合，所以需要储备一些网络虚拟化知识，了解下原理&lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;h1 id=&quot;overlay&quot;&gt;&lt;a href=&quot;#overlay&quot; class=&quot;headerlink&quot; title=&quot;overlay&quot;&gt;&lt;/a&gt;overlay&lt;/h1&gt;&lt;p&gt;我的理解&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;复用已有物理网络，很容易搭建&lt;/li&gt;
&lt;li&gt;有很好的开源组件，比如flannel&lt;/li&gt;
&lt;li&gt;需要转发&lt;/li&gt;
&lt;li&gt;需要对原报文进行封装和解释，因为会加上overlay的src ip和des ip&lt;/li&gt;
&lt;li&gt;性能会损耗&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;阿里云的大侠们曾做过试验&lt;a href=&quot;http://dockone.io/article/1232&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;原文链接&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Overlay网络的最大问题是性能很不理想。我们做了Overlay网络和非Overlay网络在各种数据包大小情况下的性能对比，tcp payload 20 bytes，Overlay性能大约 75%，tcp payload 1kbytes，Overlay性能80%，对于大块数据传输，Overlay性能大约88%，这个数字可以认为是 Overlay性能的极限了。当然，不同的场景下具体测试数字不一定完全一致，但Overlay的开销还是很大的。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&quot;flannel&quot;&gt;&lt;a href=&quot;#flannel&quot; class=&quot;headerlink&quot; title=&quot;flannel&quot;&gt;&lt;/a&gt;flannel&lt;/h1&gt;&lt;p&gt;coreos的又一力作，docker生态常用组网方式&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://raw.githubusercontent.com/coreos/flannel/master/packet-01.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;对于原理，我的理解&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;flannel0网桥，连接docker0和flanneld&lt;/li&gt;
&lt;li&gt;flanneld通过etcd感知到网络内所有docker IP的变化，知道如果投递到其他宿主机上的flanneld&lt;/li&gt;
&lt;li&gt;docker daemon启动参数可以限制IP范围，避免冲突&lt;/li&gt;
&lt;li&gt;从容器A到另外一台宿主机上的容器B，大概流程&lt;ol&gt;
&lt;li&gt;报文到容器A的veth0&lt;/li&gt;
&lt;li&gt;再到docker0&lt;/li&gt;
&lt;li&gt;转到容器A所在宿主机的flanneld，简称flanneldA&lt;/li&gt;
&lt;li&gt;flanneldA，所谓的封装，src ip，des ip&lt;/li&gt;
&lt;li&gt;投递到容器B所在宿主机的flanneld，简称flanneldB&lt;/li&gt;
&lt;li&gt;flanneldB解释，获取到des ip，取出原始报文，投递到容器B&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;&lt;code&gt;本博客欢迎转发,但请保留原作者信息&lt;/code&gt;&lt;br&gt;github:&lt;a href=&quot;https://github.com/CodeJuan&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;codejuan&lt;/a&gt;&lt;br&gt;博客地址:&lt;a href=&quot;http://blog.decbug.com/&quot;&gt;http://blog.decbug.com/&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;正在搞docker与neutron融合，所以需要储备一些网络虚拟化知识，了解下原理&lt;/p&gt;
    
    </summary>
    
      <category term="code" scheme="http://blog.decbug.com/categories/code/"/>
    
    
      <category term="network" scheme="http://blog.decbug.com/tags/network/"/>
    
      <category term="overlay" scheme="http://blog.decbug.com/tags/overlay/"/>
    
      <category term="virtualization" scheme="http://blog.decbug.com/tags/virtualization/"/>
    
  </entry>
  
  <entry>
    <title>玩openstack:1</title>
    <link href="http://blog.decbug.com/2016/06/21/openstack_playground_1/"/>
    <id>http://blog.decbug.com/2016/06/21/openstack_playground_1/</id>
    <published>2016-06-21T11:00:00.000Z</published>
    <updated>2016-06-29T13:21:22.619Z</updated>
    
    <content type="html">&lt;h1 id=&quot;背景&quot;&gt;&lt;a href=&quot;#背景&quot; class=&quot;headerlink&quot; title=&quot;背景&quot;&gt;&lt;/a&gt;背景&lt;/h1&gt;&lt;p&gt;要基于公司已有的openstack结合docker搞一个好玩的东西，所以又开始撸openstack了，这就需要对虚拟化有个更深入的理解。&lt;br&gt;昨天搞整了一下KVM和vlan，&lt;a href=&quot;http://blog.decbug.com/2016/06/20/kvm/&quot;&gt;http://blog.decbug.com/2016/06/20/kvm/&lt;/a&gt;&lt;br&gt;今天就要在家搞一套openstack开发环境&lt;br&gt;&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&quot;devstack&quot;&gt;&lt;a href=&quot;#devstack&quot; class=&quot;headerlink&quot; title=&quot;devstack&quot;&gt;&lt;/a&gt;devstack&lt;/h1&gt;&lt;p&gt;devstack是一个一键式搭建open stack环境的脚本，如官网所说&lt;code&gt;DevStack is a series of extensible scripts used to quickly bring up a complete OpenStack environment.&lt;/code&gt;&lt;br&gt;&lt;figure class=&quot;highlight stata&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;git clone https:&lt;span class=&quot;comment&quot;&gt;//github.com/openstack-dev/devstack.git&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;cd&lt;/span&gt; devstack/&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# 切换到&lt;span class=&quot;keyword&quot;&gt;m&lt;/span&gt;版本分支&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;git co stable/mitaka&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;cd&lt;/span&gt; tools&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# 创建&lt;span class=&quot;keyword&quot;&gt;stack&lt;/span&gt;用户&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;sudo bash create-&lt;span class=&quot;keyword&quot;&gt;stack&lt;/span&gt;-user.&lt;span class=&quot;keyword&quot;&gt;sh&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# &lt;span class=&quot;keyword&quot;&gt;cd&lt;/span&gt; ../../&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;sudo mv devstack /opt/&lt;span class=&quot;keyword&quot;&gt;stack&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;sudo chown -R &lt;span class=&quot;keyword&quot;&gt;stack&lt;/span&gt;:&lt;span class=&quot;keyword&quot;&gt;stack&lt;/span&gt; /opt/&lt;span class=&quot;keyword&quot;&gt;stack&lt;/span&gt;/devstack&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# switch to &lt;span class=&quot;keyword&quot;&gt;stack&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;sudo -&lt;span class=&quot;literal&quot;&gt;i&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;su&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;stack&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;参照&lt;a href=&quot;http://docs.openstack.org/developer/devstack/guides/neutron.html#id3&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;官网&lt;/a&gt;在&lt;code&gt;/opt/stack/devstack&lt;/code&gt;创建local.conf，内容是&lt;br&gt;记得改host_ip,service_host,PUBLIC_INTERFACE&lt;/p&gt;
&lt;h2 id=&quot;controller&quot;&gt;&lt;a href=&quot;#controller&quot; class=&quot;headerlink&quot; title=&quot;controller&quot;&gt;&lt;/a&gt;controller&lt;/h2&gt;&lt;figure class=&quot;highlight cpp&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;[[local|localrc]]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;HOST_IP=&lt;span class=&quot;number&quot;&gt;192.168&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.1&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.245&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;SERVICE_HOST=&lt;span class=&quot;number&quot;&gt;192.168&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.1&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.245&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;MYSQL_HOST=&lt;span class=&quot;number&quot;&gt;192.168&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.1&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.245&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;RABBIT_HOST=&lt;span class=&quot;number&quot;&gt;192.168&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.1&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.245&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;GLANCE_HOSTPORT=&lt;span class=&quot;number&quot;&gt;192.168&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.1&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.245&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;9292&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;PUBLIC_INTERFACE=p1p1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;ADMIN_PASSWORD=secret&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;MYSQL_PASSWORD=secret&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;RABBIT_PASSWORD=secret&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;SERVICE_PASSWORD=secret&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;preprocessor&quot;&gt;## Neutron options&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Q_USE_SECGROUP=True&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;ENABLE_PROJECT_VLANS=True&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;PROJECT_VLAN_RANGE=&lt;span class=&quot;number&quot;&gt;3001&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;4000&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;PHYSICAL_NETWORK=&lt;span class=&quot;keyword&quot;&gt;default&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;OVS_PHYSICAL_BRIDGE=br-ex&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Q_USE_PROVIDER_NETWORKING=True&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;preprocessor&quot;&gt;# Do not use Nova-Network&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;disable_service n-net&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;preprocessor&quot;&gt;# Neutron&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;ENABLED_SERVICES+=,q-svc,q-dhcp,q-meta,q-agt&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;preprocessor&quot;&gt;## Neutron Networking options used to create Neutron Subnets&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;FIXED_RANGE=&lt;span class=&quot;string&quot;&gt;&quot;203.0.113.0/24&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;NETWORK_GATEWAY=&lt;span class=&quot;number&quot;&gt;203.0&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.113&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;PROVIDER_SUBNET_NAME=&lt;span class=&quot;string&quot;&gt;&quot;provider_net&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;PROVIDER_NETWORK_TYPE=&lt;span class=&quot;string&quot;&gt;&quot;vlan&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;SEGMENTATION_ID=&lt;span class=&quot;number&quot;&gt;2010&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;preprocessor&quot;&gt;# use TryStack git mirror&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;GIT_BASE=http:&lt;span class=&quot;comment&quot;&gt;//git.trystack.cn&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;NOVNC_REPO=http:&lt;span class=&quot;comment&quot;&gt;//git.trystack.cn/kanaka/noVNC.git&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;SPICE_REPO=http:&lt;span class=&quot;comment&quot;&gt;//git.trystack.cn/git/spice/spice-html5.git&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;compute-node&quot;&gt;&lt;a href=&quot;#compute-node&quot; class=&quot;headerlink&quot; title=&quot;compute node&quot;&gt;&lt;/a&gt;compute node&lt;/h2&gt;&lt;figure class=&quot;highlight cpp&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;[[local|localrc]]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;HOST_IP=&lt;span class=&quot;number&quot;&gt;192.168&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.1&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.148&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;SERVICE_HOST=&lt;span class=&quot;number&quot;&gt;192.168&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.1&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.245&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;MYSQL_HOST=&lt;span class=&quot;number&quot;&gt;192.168&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.1&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.245&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;RABBIT_HOST=&lt;span class=&quot;number&quot;&gt;192.168&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.1&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.245&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;GLANCE_HOSTPORT=&lt;span class=&quot;number&quot;&gt;192.168&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.1&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.245&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;9292&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;ADMIN_PASSWORD=secret&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;MYSQL_PASSWORD=secret&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;RABBIT_PASSWORD=secret&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;SERVICE_PASSWORD=secret&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;preprocessor&quot;&gt;# Services that a compute node runs&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;ENABLED_SERVICES=n-cpu,rabbit,q-agt&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;preprocessor&quot;&gt;## Open vSwitch provider networking options&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;PHYSICAL_NETWORK=&lt;span class=&quot;keyword&quot;&gt;default&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;OVS_PHYSICAL_BRIDGE=br-ex&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;PUBLIC_INTERFACE=p2p1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Q_USE_PROVIDER_NETWORKING=True&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;preprocessor&quot;&gt;# use TryStack git mirror&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;GIT_BASE=http:&lt;span class=&quot;comment&quot;&gt;//git.trystack.cn&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;NOVNC_REPO=http:&lt;span class=&quot;comment&quot;&gt;//git.trystack.cn/kanaka/noVNC.git&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;SPICE_REPO=http:&lt;span class=&quot;comment&quot;&gt;//git.trystack.cn/git/spice/spice-html5.git&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;然后运行&lt;br&gt;&lt;figure class=&quot;highlight stata&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;bash /&lt;span class=&quot;keyword&quot;&gt;stack&lt;/span&gt;.&lt;span class=&quot;keyword&quot;&gt;sh&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;参考&lt;a href=&quot;http://blog.csdn.net/u011521019/article/details/51114681&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://blog.csdn.net/u011521019/article/details/51114681&lt;/a&gt;&lt;br&gt;改成我的实际IP&lt;br&gt;提示&lt;br&gt;&lt;figure class=&quot;highlight cpp&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;number&quot;&gt;2016&lt;/span&gt;-&lt;span class=&quot;number&quot;&gt;06&lt;/span&gt;-&lt;span class=&quot;number&quot;&gt;21&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;14&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;07&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;28.255&lt;/span&gt; | ovs-ofctl: br-&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; is not a bridge or a socket&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;number&quot;&gt;2016&lt;/span&gt;-&lt;span class=&quot;number&quot;&gt;06&lt;/span&gt;-&lt;span class=&quot;number&quot;&gt;21&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;14&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;07&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;28.262&lt;/span&gt; | ovs-ofctl: br-tun is not a bridge or a socket&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;number&quot;&gt;2016&lt;/span&gt;-&lt;span class=&quot;number&quot;&gt;06&lt;/span&gt;-&lt;span class=&quot;number&quot;&gt;21&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;14&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;07&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;28.269&lt;/span&gt; | ovs-ofctl: br-ex is not a bridge or a socket&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;number&quot;&gt;2016&lt;/span&gt;-&lt;span class=&quot;number&quot;&gt;06&lt;/span&gt;-&lt;span class=&quot;number&quot;&gt;21&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;14&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;07&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;28.277&lt;/span&gt; | ovs-ofctl: br-&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; is not a bridge or a socket&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;number&quot;&gt;2016&lt;/span&gt;-&lt;span class=&quot;number&quot;&gt;06&lt;/span&gt;-&lt;span class=&quot;number&quot;&gt;21&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;14&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;07&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;28.284&lt;/span&gt; | ovs-ofctl: br-tun is not a bridge or a socket&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;number&quot;&gt;2016&lt;/span&gt;-&lt;span class=&quot;number&quot;&gt;06&lt;/span&gt;-&lt;span class=&quot;number&quot;&gt;21&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;14&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;07&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;28.292&lt;/span&gt; | ovs-ofctl: br-ex is not a bridge or a socket&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;number&quot;&gt;2016&lt;/span&gt;-&lt;span class=&quot;number&quot;&gt;06&lt;/span&gt;-&lt;span class=&quot;number&quot;&gt;21&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;14&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;07&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;28.446&lt;/span&gt; | +^[[&lt;span class=&quot;number&quot;&gt;3242&lt;/span&gt;mstack.sh:exit_trap:&lt;span class=&quot;number&quot;&gt;498&lt;/span&gt;                   ^[(B^[[m &lt;span class=&quot;built_in&quot;&gt;exit&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;说要unstack.sh，然后reboot，再stack.sh，然而还是一样的错&lt;/p&gt;
&lt;figure class=&quot;highlight vala&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;preprocessor&quot;&gt;# minimal config&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;preprocessor&quot;&gt;# devstack generate-subunit fail&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;sudo apt-&lt;span class=&quot;keyword&quot;&gt;get&lt;/span&gt; install python-pip&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;sudo pip install --upgrade pip&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;hr&gt;
&lt;p&gt;&lt;code&gt;本博客欢迎转发,但请保留原作者信息&lt;/code&gt;&lt;br&gt;github:&lt;a href=&quot;https://github.com/CodeJuan&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;codejuan&lt;/a&gt;&lt;br&gt;博客地址:&lt;a href=&quot;http://blog.decbug.com/&quot;&gt;http://blog.decbug.com/&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;背景&quot;&gt;&lt;a href=&quot;#背景&quot; class=&quot;headerlink&quot; title=&quot;背景&quot;&gt;&lt;/a&gt;背景&lt;/h1&gt;&lt;p&gt;要基于公司已有的openstack结合docker搞一个好玩的东西，所以又开始撸openstack了，这就需要对虚拟化有个更深入的理解。&lt;br&gt;昨天搞整了一下KVM和vlan，&lt;a href=&quot;http://blog.decbug.com/2016/06/20/kvm/&quot;&gt;http://blog.decbug.com/2016/06/20/kvm/&lt;/a&gt;&lt;br&gt;今天就要在家搞一套openstack开发环境&lt;br&gt;
    
    </summary>
    
      <category term="code" scheme="http://blog.decbug.com/categories/code/"/>
    
    
      <category term="devstack" scheme="http://blog.decbug.com/tags/devstack/"/>
    
      <category term="openstack" scheme="http://blog.decbug.com/tags/openstack/"/>
    
  </entry>
  
  <entry>
    <title>在内网写的文章</title>
    <link href="http://blog.decbug.com/2016/06/21/blog_huawei/"/>
    <id>http://blog.decbug.com/2016/06/21/blog_huawei/</id>
    <published>2016-06-20T18:00:00.000Z</published>
    <updated>2016-06-29T13:21:22.619Z</updated>
    
    <content type="html">&lt;h1 id=&quot;说明&quot;&gt;&lt;a href=&quot;#说明&quot; class=&quot;headerlink&quot; title=&quot;说明&quot;&gt;&lt;/a&gt;说明&lt;/h1&gt;&lt;p&gt;在内网也写了不少文章，但是由于安全问题，不能搬运出来，只能把标题都记录下来，以免遗忘&lt;br&gt;&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&quot;install&quot;&gt;&lt;a href=&quot;#install&quot; class=&quot;headerlink&quot; title=&quot;install&quot;&gt;&lt;/a&gt;install&lt;/h1&gt;&lt;p&gt;&lt;img src=&quot;https://raw.githubusercontent.com/CodeJuan/codejuan.github.io/master/images/blog/huawei_blog/7.jpeg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://raw.githubusercontent.com/CodeJuan/codejuan.github.io/master/images/blog/huawei_blog/6.jpeg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://raw.githubusercontent.com/CodeJuan/codejuan.github.io/master/images/blog/huawei_blog/5.jpeg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://raw.githubusercontent.com/CodeJuan/codejuan.github.io/master/images/blog/huawei_blog/4.jpeg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://raw.githubusercontent.com/CodeJuan/codejuan.github.io/master/images/blog/huawei_blog/3.jpeg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://raw.githubusercontent.com/CodeJuan/codejuan.github.io/master/images/blog/huawei_blog/2.jpeg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://raw.githubusercontent.com/CodeJuan/codejuan.github.io/master/images/blog/huawei_blog/1.jpeg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;&lt;code&gt;本博客欢迎转发,但请保留原作者信息&lt;/code&gt;&lt;br&gt;github:&lt;a href=&quot;https://github.com/CodeJuan&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;codejuan&lt;/a&gt;&lt;br&gt;博客地址:&lt;a href=&quot;http://blog.decbug.com/&quot;&gt;http://blog.decbug.com/&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;说明&quot;&gt;&lt;a href=&quot;#说明&quot; class=&quot;headerlink&quot; title=&quot;说明&quot;&gt;&lt;/a&gt;说明&lt;/h1&gt;&lt;p&gt;在内网也写了不少文章，但是由于安全问题，不能搬运出来，只能把标题都记录下来，以免遗忘&lt;br&gt;
    
    </summary>
    
      <category term="code" scheme="http://blog.decbug.com/categories/code/"/>
    
    
      <category term="blog" scheme="http://blog.decbug.com/tags/blog/"/>
    
  </entry>
  
  <entry>
    <title>2016上半年随笔</title>
    <link href="http://blog.decbug.com/2016/06/21/essay20160620/"/>
    <id>http://blog.decbug.com/2016/06/21/essay20160620/</id>
    <published>2016-06-20T17:00:00.000Z</published>
    <updated>2016-06-29T13:21:22.619Z</updated>
    
    <content type="html">&lt;p&gt;时间已经来到2016的6月底，是时候回顾这上半年的收获与教训&lt;br&gt;&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&quot;工作&quot;&gt;&lt;a href=&quot;#工作&quot; class=&quot;headerlink&quot; title=&quot;工作&quot;&gt;&lt;/a&gt;工作&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;对docker的应用越发纯熟，用registry+swarm+用golang写的一些服务，搞了个持续交付容器云，从代码-&amp;gt;持续集成-&amp;gt;镜像-&amp;gt;仓库-&amp;gt;运行服务&lt;/li&gt;
&lt;li&gt;上半年在的部门是研发质量部，主要是基于一些砖家们的YY做了一些没人用的产品。我不断地反对他们的想法，因为我觉得他的方案完全是不可行的，他们都很久不写代码，而且离业务很远，根本不知道业务的情况。反对的次数多了，我们互相之间就两看两相厌。事实证明，我的意见是正确的，他们花了4个月做出来的东西，在演示阶段就被否决了。&lt;/li&gt;
&lt;li&gt;这次教训挺深刻的，让我从一个纯粹的技术人员，进化成有产品意识的程序员。技术是解决业务的问题，做出来的东西要有价值，那么什么是价值呢，好吧，其实就是能赚钱。公司是商业组织，目的就是为了盈利。唉。&lt;/li&gt;
&lt;li&gt;以前是在百人团队里当技术砖家，就是技术选型，写demo，写核心代码，还有教小朋友写代码，帮他们解决疑难杂症，只需要管技术方面的问题，其他事都不用操心，压力不怎么大。16年上半年算是自己独立带团队了，虽然人不多，但是压力不小，要定技术方案，写代码，画流程图，测试，关注小弟们的进展，把控进度，还要思考产品的价值。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;技术上进步不大，但是技术之外的能力进步很大，总体来说，收获还是挺大的。&lt;/p&gt;
&lt;h1 id=&quot;学习&quot;&gt;&lt;a href=&quot;#学习&quot; class=&quot;headerlink&quot; title=&quot;学习&quot;&gt;&lt;/a&gt;学习&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;看书&lt;ol&gt;
&lt;li&gt;分布式的书&lt;/li&gt;
&lt;li&gt;看了TCP/IP，HTTP协议&lt;/li&gt;
&lt;li&gt;容器相关的书&lt;/li&gt;
&lt;li&gt;JVM的书&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;前端，学了angularjs，bootstrap，写了几个小项目练手&lt;/li&gt;
&lt;li&gt;英语，整理了计算机英语1500词&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&quot;更好的工作机会&quot;&gt;&lt;a href=&quot;#更好的工作机会&quot; class=&quot;headerlink&quot; title=&quot;更好的工作机会&quot;&gt;&lt;/a&gt;更好的工作机会&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;面了京东云，offer T4&lt;/li&gt;
&lt;li&gt;面了阿里云，offer P7&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;一直在传统行业厮混，没有互联网经验。凭借我自己在家折腾的一些玩具，得到一线互联网公司的认可，也算是证明了我的实力&lt;br&gt;然而在我提了离职之后，父亲得了重病住院。此病几乎就是不治之症，只能缓解并发症，延长存活时间。母亲一人照顾不过来，我不能那么自私，抛下家里去北京。&lt;br&gt;本打算7月去北京工作，但由于父亲生病，暂时去不了，不得不放弃这个机会。希望以后有机会再去互联网公司干一番事业&lt;br&gt;悲剧的是，我提离职了却去不了北京，几乎就要失业。&lt;br&gt;好在我司这边还有部门愿意接收我，不然我就要失业一段时间。其实挺感激的，对我来说算是雪中送炭吧。在接下来的工作中，我要好好努力&lt;br&gt;另外，还要感谢我自己，一直都在学习进步，保持了足够的竞争力。只要有实力，就不用担心工作的事，一大堆职位等着我挑选&lt;/p&gt;
&lt;h1 id=&quot;买房&quot;&gt;&lt;a href=&quot;#买房&quot; class=&quot;headerlink&quot; title=&quot;买房&quot;&gt;&lt;/a&gt;买房&lt;/h1&gt;&lt;p&gt;还是在西安买房了。&lt;br&gt;本打算买了房就去北京的，然后几年之后再回西安。然而计划总是赶不上变化，早知如此，就不买了。&lt;br&gt;好在买的房还可以，也算是有所收获吧&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;位置比较偏，但小区门口就是地铁，也还算方便。&lt;/li&gt;
&lt;li&gt;小区里的小学已拿到政府批文，正在建造。旁边有初中和一般高中，还有某一流高中的分校，教育资源貌似还可以。&lt;/li&gt;
&lt;li&gt;附近正在建一家三甲医院&lt;/li&gt;
&lt;li&gt;小区旁边有个万象城，商业也还可以&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;2011年来到西安工作，至今已经4年半，在家里负担比较重的情况下，能在5年之内搞定二套房，也还算可以。&lt;/p&gt;
&lt;p&gt;希望这次的选择是正确的&lt;/p&gt;
&lt;h1 id=&quot;买车&quot;&gt;&lt;a href=&quot;#买车&quot; class=&quot;headerlink&quot; title=&quot;买车&quot;&gt;&lt;/a&gt;买车&lt;/h1&gt;&lt;p&gt;下半年把驾照搞定，到明年过年的时候整辆小车车开&lt;/p&gt;
&lt;h1 id=&quot;下半年计划&quot;&gt;&lt;a href=&quot;#下半年计划&quot; class=&quot;headerlink&quot; title=&quot;下半年计划&quot;&gt;&lt;/a&gt;下半年计划&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;英语必然不能落下，要继续听说读&lt;/li&gt;
&lt;li&gt;底层原理还是不够熟悉，打算把那几本神书再翻一遍&lt;/li&gt;
&lt;li&gt;接下来的工作是基于华为云做Docker相关的产品。OpenStack和Docker都是分布式系统的经典之作，我要在这个过程中，把分布式架构/网络/存储搞懂&lt;/li&gt;
&lt;li&gt;想有一个代表作，一个由我设计，架构，开发的产品&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;&lt;code&gt;本博客欢迎转发,但请保留原作者信息&lt;/code&gt;&lt;br&gt;github:&lt;a href=&quot;https://github.com/CodeJuan&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;codejuan&lt;/a&gt;&lt;br&gt;博客地址:&lt;a href=&quot;http://blog.decbug.com/&quot;&gt;http://blog.decbug.com/&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;时间已经来到2016的6月底，是时候回顾这上半年的收获与教训&lt;br&gt;
    
    </summary>
    
      <category term="mumble" scheme="http://blog.decbug.com/categories/mumble/"/>
    
    
      <category term="essay" scheme="http://blog.decbug.com/tags/essay/"/>
    
  </entry>
  
  <entry>
    <title>学习KVM与网络虚拟化</title>
    <link href="http://blog.decbug.com/2016/06/20/kvm/"/>
    <id>http://blog.decbug.com/2016/06/20/kvm/</id>
    <published>2016-06-19T16:00:00.000Z</published>
    <updated>2016-06-29T13:21:22.619Z</updated>
    
    <content type="html">&lt;h1 id=&quot;背景&quot;&gt;&lt;a href=&quot;#背景&quot; class=&quot;headerlink&quot; title=&quot;背景&quot;&gt;&lt;/a&gt;背景&lt;/h1&gt;&lt;p&gt;要基于公司已有的openstack结合docker搞一个好玩的东西，所以又开始撸openstack了，这就需要对虚拟化有个更深入的理解。&lt;br&gt;那么从KVM开始，是一个不错的选择。&lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;h1 id=&quot;KVM基础概念&quot;&gt;&lt;a href=&quot;#KVM基础概念&quot; class=&quot;headerlink&quot; title=&quot;KVM基础概念&quot;&gt;&lt;/a&gt;KVM基础概念&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;虚拟化的三种类型，1型，2型，进程虚拟化&lt;/li&gt;
&lt;li&gt;KVM是2型，是运行在操作系统之上的&lt;/li&gt;
&lt;li&gt;docker就是进程虚拟化，直接用host的内核&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&quot;安装KVM&quot;&gt;&lt;a href=&quot;#安装KVM&quot; class=&quot;headerlink&quot; title=&quot;安装KVM&quot;&gt;&lt;/a&gt;安装KVM&lt;/h1&gt;&lt;figure class=&quot;highlight nimrod&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;sudo apt-get install qemu-kvm qemu-system libvirt-bin virt-manager bridge-utils vlan&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# 查看是否支持虚拟化，要返回vmx&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;egrep -o &#39;(vmx|svm)&#39; /&lt;span class=&quot;keyword&quot;&gt;proc&lt;/span&gt;/cpuinfo&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# 查看是否安装成功&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;sudo service libvirt-bin status&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h1 id=&quot;启动虚拟机&quot;&gt;&lt;a href=&quot;#启动虚拟机&quot; class=&quot;headerlink&quot; title=&quot;启动虚拟机&quot;&gt;&lt;/a&gt;启动虚拟机&lt;/h1&gt;&lt;p&gt;下载镜像&lt;a href=&quot;http://download.cirros-cloud.net/0.3.4/cirros-0.3.4-x86_64-disk.img&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;cirros-0.3.4-x86_64-disk.img&lt;/a&gt;，拷贝到&lt;code&gt;cp cirros-0.3.4-x86_64-disk.img /var/lib/libvirt/images/&lt;/code&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight nginx&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;title&quot;&gt;sudo&lt;/span&gt; virt-manager&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# 图形界面，创建虚拟机&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h1 id=&quot;网络虚拟化&quot;&gt;&lt;a href=&quot;#网络虚拟化&quot; class=&quot;headerlink&quot; title=&quot;网络虚拟化&quot;&gt;&lt;/a&gt;网络虚拟化&lt;/h1&gt;&lt;h2 id=&quot;nat和br&quot;&gt;&lt;a href=&quot;#nat和br&quot; class=&quot;headerlink&quot; title=&quot;nat和br&quot;&gt;&lt;/a&gt;nat和br&lt;/h2&gt;&lt;p&gt;&lt;img src=&quot;https://raw.githubusercontent.com/CodeJuan/codejuan.github.io/master/images/blog/network_virtualization/nat_br.jpg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;vlan&quot;&gt;&lt;a href=&quot;#vlan&quot; class=&quot;headerlink&quot; title=&quot;vlan&quot;&gt;&lt;/a&gt;vlan&lt;/h2&gt;&lt;p&gt;&lt;img src=&quot;https://raw.githubusercontent.com/CodeJuan/codejuan.github.io/master/images/blog/network_virtualization/vlan.jpg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;&lt;code&gt;本博客欢迎转发,但请保留原作者信息&lt;/code&gt;&lt;br&gt;github:&lt;a href=&quot;https://github.com/CodeJuan&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;codejuan&lt;/a&gt;&lt;br&gt;博客地址:&lt;a href=&quot;http://blog.decbug.com/&quot;&gt;http://blog.decbug.com/&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;背景&quot;&gt;&lt;a href=&quot;#背景&quot; class=&quot;headerlink&quot; title=&quot;背景&quot;&gt;&lt;/a&gt;背景&lt;/h1&gt;&lt;p&gt;要基于公司已有的openstack结合docker搞一个好玩的东西，所以又开始撸openstack了，这就需要对虚拟化有个更深入的理解。&lt;br&gt;那么从KVM开始，是一个不错的选择。&lt;/p&gt;
    
    </summary>
    
      <category term="code" scheme="http://blog.decbug.com/categories/code/"/>
    
    
      <category term="kvm" scheme="http://blog.decbug.com/tags/kvm/"/>
    
      <category term="openstack" scheme="http://blog.decbug.com/tags/openstack/"/>
    
  </entry>
  
  <entry>
    <title>hexo通过travis CI自动发布</title>
    <link href="http://blog.decbug.com/2016/05/31/hexo_travis/"/>
    <id>http://blog.decbug.com/2016/05/31/hexo_travis/</id>
    <published>2016-05-30T16:00:00.000Z</published>
    <updated>2016-06-29T13:21:22.619Z</updated>
    
    <content type="html">&lt;h1 id=&quot;背景&quot;&gt;&lt;a href=&quot;#背景&quot; class=&quot;headerlink&quot; title=&quot;背景&quot;&gt;&lt;/a&gt;背景&lt;/h1&gt;&lt;p&gt;github pages支持jekyll自动发布，只要修改了post的md，就会自动生成gh-pages。但不支持hexo，所以需要通过第三方的系统来执行hexo generate并把生成的静态页面push到gh-pages。&lt;br&gt;之前用过Travis ci，感觉不错，打算继续用它。&lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;ol&gt;
&lt;li&gt;通过github帐号登录travis ci，把博客的repo加入到左边的My Repositories&lt;/li&gt;
&lt;li&gt;在博客repo编写.travis.yml，用于编排&lt;/li&gt;
&lt;li&gt;在github-setting-personal token-生成一个只能访问public repo的token&lt;/li&gt;
&lt;li&gt;在travis ci的Repositories添加环境变量DEPLOY_REPO， &lt;a href=&quot;https://{token}@github.com/{你的用户名}/{你的repo名}.git&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://{token}@github.com/{你的用户名}/{你的repo名}.git&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;figure class=&quot;highlight xquery&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;git clone --depth &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt; --branch gh-pages --single-branch &lt;span class=&quot;variable&quot;&gt;$DEPLOY&lt;/span&gt;_REPO . || (git init &amp;amp;&amp;amp; git remote add -t gh-pages origin &lt;span class=&quot;variable&quot;&gt;$DEPLOY&lt;/span&gt;_REPO)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;PS: travis ci的日志放在aws s3上，所以要先番茄才能看到日志哦&lt;/p&gt;
&lt;h1 id=&quot;参考&quot;&gt;&lt;a href=&quot;#参考&quot; class=&quot;headerlink&quot; title=&quot;参考&quot;&gt;&lt;/a&gt;参考&lt;/h1&gt;&lt;p&gt;&lt;a href=&quot;http://www.jianshu.com/p/e22c13d85659&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://www.jianshu.com/p/e22c13d85659&lt;/a&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;&lt;code&gt;本博客欢迎转发,但请保留原作者信息&lt;/code&gt;&lt;br&gt;github:&lt;a href=&quot;https://github.com/CodeJuan&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;codejuan&lt;/a&gt;&lt;br&gt;博客地址:&lt;a href=&quot;http://blog.decbug.com/&quot;&gt;http://blog.decbug.com/&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;背景&quot;&gt;&lt;a href=&quot;#背景&quot; class=&quot;headerlink&quot; title=&quot;背景&quot;&gt;&lt;/a&gt;背景&lt;/h1&gt;&lt;p&gt;github pages支持jekyll自动发布，只要修改了post的md，就会自动生成gh-pages。但不支持hexo，所以需要通过第三方的系统来执行hexo generate并把生成的静态页面push到gh-pages。&lt;br&gt;之前用过Travis ci，感觉不错，打算继续用它。&lt;/p&gt;
    
    </summary>
    
      <category term="code" scheme="http://blog.decbug.com/categories/code/"/>
    
    
      <category term="blog" scheme="http://blog.decbug.com/tags/blog/"/>
    
      <category term="travis" scheme="http://blog.decbug.com/tags/travis/"/>
    
  </entry>
  
  <entry>
    <title>一切脱离业务的设计都是YY</title>
    <link href="http://blog.decbug.com/2016/05/29/biz_and_req/"/>
    <id>http://blog.decbug.com/2016/05/29/biz_and_req/</id>
    <published>2016-05-28T16:00:00.000Z</published>
    <updated>2016-06-29T13:21:22.619Z</updated>
    
    <content type="html">&lt;h1 id=&quot;背景&quot;&gt;&lt;a href=&quot;#背景&quot; class=&quot;headerlink&quot; title=&quot;背景&quot;&gt;&lt;/a&gt;背景&lt;/h1&gt;&lt;p&gt;现在是在工具团队，做的产品都是给业务来用的，业务就是我们的客户。那么业务又是什么呢？业务就是给公司赚钱的产品。&lt;br&gt;然而有时候，我们的专家们却总是脱离业务来YY方案，然后做出一些令人难以理解的产品。&lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;h1 id=&quot;业务&quot;&gt;&lt;a href=&quot;#业务&quot; class=&quot;headerlink&quot; title=&quot;业务&quot;&gt;&lt;/a&gt;业务&lt;/h1&gt;&lt;p&gt;又到了一年一度组里领导和专家们YY方案的时候。在他们做4月份里程碑的时候，我就提出，这个方案不靠谱，甚至采用了不参与架构设计不参与开发来威胁，然而还是没有挡住。&lt;br&gt;因为这个方案，都是基于他们的YY，完全脱离了业务。&lt;br&gt;果然，等到验收的时候，业务完全不认可，只能推倒重来。&lt;/p&gt;
&lt;h1 id=&quot;互联网公司的工具团队&quot;&gt;&lt;a href=&quot;#互联网公司的工具团队&quot; class=&quot;headerlink&quot; title=&quot;互联网公司的工具团队&quot;&gt;&lt;/a&gt;互联网公司的工具团队&lt;/h1&gt;&lt;p&gt;曾看过知乎，豆瓣，滴滴，京东的工具，他们都是属于平台部门，里边都是高手。给全公司提供监控，部署，性能优化，日志分析，以及各种牛逼中间件。&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;&lt;code&gt;本博客欢迎转发,但请保留原作者信息&lt;/code&gt;&lt;br&gt;github:&lt;a href=&quot;https://github.com/CodeJuan&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;codejuan&lt;/a&gt;&lt;br&gt;博客地址:&lt;a href=&quot;http://blog.decbug.com/&quot;&gt;http://blog.decbug.com/&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;背景&quot;&gt;&lt;a href=&quot;#背景&quot; class=&quot;headerlink&quot; title=&quot;背景&quot;&gt;&lt;/a&gt;背景&lt;/h1&gt;&lt;p&gt;现在是在工具团队，做的产品都是给业务来用的，业务就是我们的客户。那么业务又是什么呢？业务就是给公司赚钱的产品。&lt;br&gt;然而有时候，我们的专家们却总是脱离业务来YY方案，然后做出一些令人难以理解的产品。&lt;/p&gt;
    
    </summary>
    
      <category term="code" scheme="http://blog.decbug.com/categories/code/"/>
    
    
      <category term="business" scheme="http://blog.decbug.com/tags/business/"/>
    
      <category term="requirement" scheme="http://blog.decbug.com/tags/requirement/"/>
    
  </entry>
  
  <entry>
    <title>读tinyhttpd源码笔记</title>
    <link href="http://blog.decbug.com/2016/05/09/tinyhttpd/"/>
    <id>http://blog.decbug.com/2016/05/09/tinyhttpd/</id>
    <published>2016-05-08T16:00:00.000Z</published>
    <updated>2016-06-29T13:21:22.619Z</updated>
    
    <content type="html">&lt;h1 id=&quot;背景&quot;&gt;&lt;a href=&quot;#背景&quot; class=&quot;headerlink&quot; title=&quot;背景&quot;&gt;&lt;/a&gt;背景&lt;/h1&gt;&lt;p&gt;C语言实现的http server，代码简短，看完可以明了原理。&lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;h1 id=&quot;流程&quot;&gt;&lt;a href=&quot;#流程&quot; class=&quot;headerlink&quot; title=&quot;流程&quot;&gt;&lt;/a&gt;流程&lt;/h1&gt;&lt;p&gt;&lt;img src=&quot;https://raw.githubusercontent.com/CodeJuan/codejuan.github.io/master/images/blog/tinyhttpd/flow.jpg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;startup，创建socket，bind，listen&lt;/li&gt;
&lt;li&gt;accept request&lt;/li&gt;
&lt;li&gt;获取请求，读header&lt;/li&gt;
&lt;li&gt;是否GET 或 POST&lt;/li&gt;
&lt;li&gt;读content length&lt;/li&gt;
&lt;li&gt;写header 200&lt;/li&gt;
&lt;li&gt;GET就serve file，cat index.html 到 send&lt;/li&gt;
&lt;li&gt;POST就创建pipe执行脚本，结果send&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;&lt;code&gt;本博客欢迎转发,但请保留原作者信息&lt;/code&gt;&lt;br&gt;github:&lt;a href=&quot;https://github.com/CodeJuan&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;codejuan&lt;/a&gt;&lt;br&gt;博客地址:&lt;a href=&quot;http://blog.decbug.com/&quot;&gt;http://blog.decbug.com/&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;背景&quot;&gt;&lt;a href=&quot;#背景&quot; class=&quot;headerlink&quot; title=&quot;背景&quot;&gt;&lt;/a&gt;背景&lt;/h1&gt;&lt;p&gt;C语言实现的http server，代码简短，看完可以明了原理。&lt;/p&gt;
    
    </summary>
    
      <category term="code" scheme="http://blog.decbug.com/categories/code/"/>
    
    
      <category term="httpserver" scheme="http://blog.decbug.com/tags/httpserver/"/>
    
      <category term="tinyhttpd" scheme="http://blog.decbug.com/tags/tinyhttpd/"/>
    
  </entry>
  
  <entry>
    <title>读memcache源码笔记</title>
    <link href="http://blog.decbug.com/2016/05/04/memcache/"/>
    <id>http://blog.decbug.com/2016/05/04/memcache/</id>
    <published>2016-05-03T16:00:00.000Z</published>
    <updated>2016-06-29T13:21:22.619Z</updated>
    
    <content type="html">&lt;h1 id=&quot;背景&quot;&gt;&lt;a href=&quot;#背景&quot; class=&quot;headerlink&quot; title=&quot;背景&quot;&gt;&lt;/a&gt;背景&lt;/h1&gt;&lt;p&gt;memcache应用很广泛，听说内存管理做的很好，以及通过事件驱动的方式效率很高，于是找来看看。&lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;h1 id=&quot;内存&quot;&gt;&lt;a href=&quot;#内存&quot; class=&quot;headerlink&quot; title=&quot;内存&quot;&gt;&lt;/a&gt;内存&lt;/h1&gt;&lt;p&gt;举例子，疯狂动物城里有各种体型的动物，分别安置在不同的城区的街道上的房子里。例如小老鼠在微型动物区，朱迪在小动物区，牛局长在大动物区，大象在大型动物区。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;先划分城区&lt;/li&gt;
&lt;li&gt;再修路&lt;/li&gt;
&lt;li&gt;再盖房子&lt;/li&gt;
&lt;li&gt;分配房间&lt;/li&gt;
&lt;li&gt;盖好的房子不拆，如果拆了再盖，会浪费资源。内存释放分配的开销很大&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&quot;https://github.com/CodeJuan/codejuan.github.io/raw/master/images/blog/memcache/mem.jpg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h1 id=&quot;流程&quot;&gt;&lt;a href=&quot;#流程&quot; class=&quot;headerlink&quot; title=&quot;流程&quot;&gt;&lt;/a&gt;流程&lt;/h1&gt;&lt;p&gt;&lt;img src=&quot;https://github.com/CodeJuan/codejuan.github.io/raw/master/images/blog/memcache/flow.jpg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h1 id=&quot;总结&quot;&gt;&lt;a href=&quot;#总结&quot; class=&quot;headerlink&quot; title=&quot;总结&quot;&gt;&lt;/a&gt;总结&lt;/h1&gt;&lt;hr&gt;
&lt;p&gt;&lt;code&gt;本博客欢迎转发,但请保留原作者信息&lt;/code&gt;&lt;br&gt;github:&lt;a href=&quot;https://github.com/CodeJuan&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;codejuan&lt;/a&gt;&lt;br&gt;博客地址:&lt;a href=&quot;http://blog.decbug.com/&quot;&gt;http://blog.decbug.com/&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;背景&quot;&gt;&lt;a href=&quot;#背景&quot; class=&quot;headerlink&quot; title=&quot;背景&quot;&gt;&lt;/a&gt;背景&lt;/h1&gt;&lt;p&gt;memcache应用很广泛，听说内存管理做的很好，以及通过事件驱动的方式效率很高，于是找来看看。&lt;/p&gt;
    
    </summary>
    
      <category term="code" scheme="http://blog.decbug.com/categories/code/"/>
    
    
      <category term="cache" scheme="http://blog.decbug.com/tags/cache/"/>
    
      <category term="memcache" scheme="http://blog.decbug.com/tags/memcache/"/>
    
  </entry>
  
  <entry>
    <title>读架构漫谈有感</title>
    <link href="http://blog.decbug.com/2016/05/03/architectrue_kevin/"/>
    <id>http://blog.decbug.com/2016/05/03/architectrue_kevin/</id>
    <published>2016-05-02T16:00:00.000Z</published>
    <updated>2016-06-29T13:21:22.619Z</updated>
    
    <content type="html">&lt;h1 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h1&gt;&lt;p&gt;来自聊聊架构公众号的系列文章，作者kevin老师。读过之后大开眼界，获益良多。&lt;br&gt;于是再读几遍，记录一下感想。&lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;h2 id=&quot;一：什么是架构&quot;&gt;&lt;a href=&quot;#一：什么是架构&quot; class=&quot;headerlink&quot; title=&quot;一：什么是架构&quot;&gt;&lt;/a&gt;一：什么是架构&lt;/h2&gt;&lt;h3 id=&quot;起源&quot;&gt;&lt;a href=&quot;#起源&quot; class=&quot;headerlink&quot; title=&quot;起源&quot;&gt;&lt;/a&gt;起源&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;人多了，就会有分工&lt;/li&gt;
&lt;li&gt;人类社会，每个人做擅长的事，与他人进行交换&lt;/li&gt;
&lt;li&gt;很多人组成了整体&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;架构&quot;&gt;&lt;a href=&quot;#架构&quot; class=&quot;headerlink&quot; title=&quot;架构&quot;&gt;&lt;/a&gt;架构&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;定界&lt;/li&gt;
&lt;li&gt;分工，分块&lt;/li&gt;
&lt;li&gt;将模块组合为整体&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;摘要&quot;&gt;&lt;a href=&quot;#摘要&quot; class=&quot;headerlink&quot; title=&quot;摘要&quot;&gt;&lt;/a&gt;摘要&lt;/h3&gt;&lt;blockquote&gt;
&lt;p&gt;这个时候人们对建筑的需求也就慢慢的越来越多，空间的切分也会变成很多种，组合的方式也会有很多种，比如每个人住的房子，群居所产生的宗教性质的房子，集体活动的房子等等。这个时候人们就开始有意识的去设计房子，架构师就慢慢的出现了。一切都是为了满足人的越来越高的需求，提升质量，减少时间，更有效率的切分空间，并且让空间之间更加有机的进行沟通。这就是建筑的架构以及建筑的架构的演变&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;p&gt;&lt;code&gt;本博客欢迎转发,但请保留原作者信息&lt;/code&gt;&lt;br&gt;github:&lt;a href=&quot;https://github.com/CodeJuan&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;codejuan&lt;/a&gt;&lt;br&gt;博客地址:&lt;a href=&quot;http://blog.decbug.com/&quot;&gt;http://blog.decbug.com/&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h1&gt;&lt;p&gt;来自聊聊架构公众号的系列文章，作者kevin老师。读过之后大开眼界，获益良多。&lt;br&gt;于是再读几遍，记录一下感想。&lt;/p&gt;
    
    </summary>
    
      <category term="architecture" scheme="http://blog.decbug.com/categories/architecture/"/>
    
    
      <category term="architecture" scheme="http://blog.decbug.com/tags/architecture/"/>
    
  </entry>
  
  <entry>
    <title>各种锁:自旋锁/互斥锁/读写锁/分布式锁</title>
    <link href="http://blog.decbug.com/2016/04/29/lock/"/>
    <id>http://blog.decbug.com/2016/04/29/lock/</id>
    <published>2016-04-28T16:00:00.000Z</published>
    <updated>2016-06-29T13:21:22.619Z</updated>
    
    <content type="html">&lt;h1 id=&quot;锁&quot;&gt;&lt;a href=&quot;#锁&quot; class=&quot;headerlink&quot; title=&quot;锁&quot;&gt;&lt;/a&gt;锁&lt;/h1&gt;&lt;p&gt;锁在计算机的世界里随处可见，当大家都想操作一个资源的时候，如果一窝蜂涌进来，就会出事的。&lt;br&gt;举个例子，加入说有2个线程都在操作一个共享资源（一个int），给他+1。我们知道+1不是原子操作，所谓原子操作，就是如果这个操作开始执行了，那么就不会被打断。看过汇编的同学都知道，+1需要先mov然后在add，如线程1mov了，然后执行线程2的mov，就会出问题。轻则数据错误，重则程序崩溃。感觉这个例子不太恰当，还是领会精神吧。为了保护我们的操作，那么就需要使得这个共享资源的操作变成原子的，这就需要锁了。&lt;br&gt;在并发编程中，尽量少用锁，能不用就不用，因为锁的开销很大很大。首先在业务层面进行分隔，尽量让不同的执行单元操作各自独立的数据，如果不可避免要用到锁，那么锁的范围要尽量小。&lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;h1 id=&quot;自旋锁vs互斥锁&quot;&gt;&lt;a href=&quot;#自旋锁vs互斥锁&quot; class=&quot;headerlink&quot; title=&quot;自旋锁vs互斥锁&quot;&gt;&lt;/a&gt;自旋锁vs互斥锁&lt;/h1&gt;&lt;h2 id=&quot;举个例子&quot;&gt;&lt;a href=&quot;#举个例子&quot; class=&quot;headerlink&quot; title=&quot;举个例子&quot;&gt;&lt;/a&gt;举个例子&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;互斥锁：假如说你想进入一个房间，但是这个房间里已经有人了。那么就进不去，这个时候你就先睡一觉，等里边的人出来把你叫醒，然后你再进去。&lt;/li&gt;
&lt;li&gt;自旋锁：还是这个房间，房间里有人，你不会睡着，只会每过一分钟就看房间里的人出来了么，如果没出来，那么就继续不停查看。如果出来了，你就进去。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;对应到系统，就是你这个线程想获取这个锁，但是这个锁被别的线程持有了，那么你这个线程就得休眠，等待锁释放后再被唤醒。要知道，休眠再唤醒的开销很大，所以就出了自旋锁。自旋锁不会休眠，会不停的尝试。&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;类&lt;/th&gt;
&lt;th&gt;特征&lt;/th&gt;
&lt;th&gt;使用场景&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;自旋&lt;/td&gt;
&lt;td&gt;不会休眠，不停重试，直到获得锁&lt;/td&gt;
&lt;td&gt;多核，如果单核的话，就一直自旋，执行线程反而得不到时间片。锁住的代码执行时间很短。因为休眠再唤醒的开销很大。如果时间短，那么自旋的开销就很小。要多核&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;互斥&lt;/td&gt;
&lt;td&gt;休眠，等锁被释放才会被唤醒&lt;/td&gt;
&lt;td&gt;锁住的代码要执行很久，如果是自旋锁，就会不停尝试，被锁住的代码分不到足够的时间片，但是性能下降&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h1 id=&quot;读写锁&quot;&gt;&lt;a href=&quot;#读写锁&quot; class=&quot;headerlink&quot; title=&quot;读写锁&quot;&gt;&lt;/a&gt;读写锁&lt;/h1&gt;&lt;p&gt;场景：读多写少&lt;br&gt;条件：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;只要没有写锁，就能获取到读锁&lt;/li&gt;
&lt;li&gt;只有没有任锁，才能获取到写锁&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;&lt;code&gt;本博客欢迎转发,但请保留原作者信息&lt;/code&gt;&lt;br&gt;github:&lt;a href=&quot;https://github.com/CodeJuan&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;codejuan&lt;/a&gt;&lt;br&gt;博客地址:&lt;a href=&quot;http://blog.decbug.com/&quot;&gt;http://blog.decbug.com/&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;锁&quot;&gt;&lt;a href=&quot;#锁&quot; class=&quot;headerlink&quot; title=&quot;锁&quot;&gt;&lt;/a&gt;锁&lt;/h1&gt;&lt;p&gt;锁在计算机的世界里随处可见，当大家都想操作一个资源的时候，如果一窝蜂涌进来，就会出事的。&lt;br&gt;举个例子，加入说有2个线程都在操作一个共享资源（一个int），给他+1。我们知道+1不是原子操作，所谓原子操作，就是如果这个操作开始执行了，那么就不会被打断。看过汇编的同学都知道，+1需要先mov然后在add，如线程1mov了，然后执行线程2的mov，就会出问题。轻则数据错误，重则程序崩溃。感觉这个例子不太恰当，还是领会精神吧。为了保护我们的操作，那么就需要使得这个共享资源的操作变成原子的，这就需要锁了。&lt;br&gt;在并发编程中，尽量少用锁，能不用就不用，因为锁的开销很大很大。首先在业务层面进行分隔，尽量让不同的执行单元操作各自独立的数据，如果不可避免要用到锁，那么锁的范围要尽量小。&lt;/p&gt;
    
    </summary>
    
      <category term="code" scheme="http://blog.decbug.com/categories/code/"/>
    
    
      <category term="lock" scheme="http://blog.decbug.com/tags/lock/"/>
    
  </entry>
  
  <entry>
    <title>阿里面试经历</title>
    <link href="http://blog.decbug.com/2016/04/11/interview_aliyun/"/>
    <id>http://blog.decbug.com/2016/04/11/interview_aliyun/</id>
    <published>2016-04-10T16:00:00.000Z</published>
    <updated>2016-06-29T13:21:22.619Z</updated>
    
    <content type="html">&lt;h1 id=&quot;背景&quot;&gt;&lt;a href=&quot;#背景&quot; class=&quot;headerlink&quot; title=&quot;背景&quot;&gt;&lt;/a&gt;背景&lt;/h1&gt;&lt;p&gt;之前一直都在通信行业撸代码，做的都是C/C++，感觉提升不大，所以打算往互联网转型，看看百万千万用户的产品是如何做出来的。&lt;br&gt;于是在拉勾上投了阿里云。&lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;h1 id=&quot;阿里云面试记录&quot;&gt;&lt;a href=&quot;#阿里云面试记录&quot; class=&quot;headerlink&quot; title=&quot;阿里云面试记录&quot;&gt;&lt;/a&gt;阿里云面试记录&lt;/h1&gt;&lt;p&gt;三轮（也许可以算四轮）技术面，一轮boss面，一轮hr，据说还有一轮hr的大boss价值观面试&lt;/p&gt;
&lt;h1 id=&quot;一轮&quot;&gt;&lt;a href=&quot;#一轮&quot; class=&quot;headerlink&quot; title=&quot;一轮&quot;&gt;&lt;/a&gt;一轮&lt;/h1&gt;&lt;p&gt;感觉是一位管理者，可能脱离技术一段时间，问的问题都是根据简历来的。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;先是问项目经验，期间问到几次，为啥要重复造轮子。&lt;/li&gt;
&lt;li&gt;docker run的原理，流程&lt;/li&gt;
&lt;li&gt;dockerfile，docker build原理&lt;/li&gt;
&lt;li&gt;C++虚函数，引用指针，&lt;/li&gt;
&lt;li&gt;手写HashMap&lt;/li&gt;
&lt;li&gt;AngularJS绑定的原理&lt;/li&gt;
&lt;li&gt;并发，我说锁啊，然后忽悠一大堆。后问如何提高性能，我说如果业务允许，应该让每个执行实例独立，不要共享资源，减少竞争&lt;/li&gt;
&lt;li&gt;弹性伸缩&lt;/li&gt;
&lt;li&gt;一致性&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&quot;二轮&quot;&gt;&lt;a href=&quot;#二轮&quot; class=&quot;headerlink&quot; title=&quot;二轮&quot;&gt;&lt;/a&gt;二轮&lt;/h1&gt;&lt;p&gt;好像是一位P8，曾在外面看过这个名字，title是高级专家&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;聊我之前的一个项目，关于我做的一个数据挖掘工具的消息推送模块的优化讨论，消息队列，锁&lt;/li&gt;
&lt;li&gt;STL remove和erase的区别&lt;/li&gt;
&lt;li&gt;vector构造析构&lt;/li&gt;
&lt;li&gt;HIVE HBASE&lt;/li&gt;
&lt;li&gt;我说给测试团队写过自动化测试框架，质疑说为啥需要自己写。我说业务啊，windows的啊，环境啊等等&lt;/li&gt;
&lt;li&gt;基于一个&lt;code&gt;随机读，追加写的文件系统&lt;/code&gt;，做一个KV存储系统，有增删改查的功能。这个比较好玩。&lt;/li&gt;
&lt;/ul&gt;
&lt;ol&gt;
&lt;li&gt;我说如果不考虑性能的话，我第一版会采用，每个K就对应一个文件，把V写到这个文件里，先实现功能，交付出去，接口调通，之后再进行优化。面试官说，快速完成的想法不错，那么后面该如何优化呢&lt;/li&gt;
&lt;li&gt;第二版，增加索引，保存K，V的长度，V到数据文件，保存K，该K对应V在数据文件中的偏移到索引文件，面试官说如果有改的请求，就需要重写整个索引文件，性能会差。我说，是的，接下来我会继续优化。&lt;/li&gt;
&lt;li&gt;第三版，如果内存够大，或者数据不会太多，那么把索引保存到内存中，省去重建索引文件的性能损耗。面试官说，内存不会太大。&lt;/li&gt;
&lt;li&gt;第四版，针对K进行hash，每个hash对应一个文件夹，文件夹里是索引文件和数据文件，通过hash可缩短搜索路径。&lt;/li&gt;
&lt;li&gt;第五版，可以把索引放到redis中，面试官说，不能用redis。我就说定时把索引文件快照到磁盘，面试官说不行，掉电就还是会丢数据。&lt;/li&gt;
&lt;li&gt;数据文件中保存K L V，只有数据文件写入成功，才更新内存中的索引。即使掉电了，也能从数据文件中重建索引。&lt;/li&gt;
&lt;li&gt;增加缓存，把热点索引保存在内存中，如内存未命中，则根据用户传入的K，从数据文件中恢复索引到内存中，冷索引则从内存中剔除。&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;go中map中 map[a].b = 1能生效吗，我说我不记得了，但如果你这么问，那么肯定是不能，因为可能是值，不是引用，指向的不是内存。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;面完之后，让我等消息&lt;/p&gt;
&lt;h1 id=&quot;三轮&quot;&gt;&lt;a href=&quot;#三轮&quot; class=&quot;headerlink&quot; title=&quot;三轮&quot;&gt;&lt;/a&gt;三轮&lt;/h1&gt;&lt;p&gt;之前两轮面试说我技术不错，能力不错，经验不错，对技术也有热情，可惜工作经验不匹配，所以把我推荐到别的组，于是需要再做一轮技术面试。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;PHP，我说我用过wordpress和phpwind，且做一个小的图片生成系统&lt;/li&gt;
&lt;li&gt;python，django和flask&lt;/li&gt;
&lt;li&gt;如何监控很多台机器，我说我看过小米open falcon的实现，在每台机器上装个agent&lt;/li&gt;
&lt;li&gt;如何控制很多台机器，我说可以参考ansible，添加到ssh的可信里，然后通过ssh来控制&lt;/li&gt;
&lt;li&gt;spring的原理&lt;/li&gt;
&lt;li&gt;linux熟不熟，问了几个命令&lt;/li&gt;
&lt;li&gt;问我会哪些脚本语言，都用来做过啥。我说shell powershell python&lt;/li&gt;
&lt;li&gt;给出一个场景，分析并解决。场景好像很简单，我一下就解决了。我在此基础上发挥了一下，提出要总结，下次遇到类似问题的时候就可以很快查到。还可以给用户提供一键式解决办法，这样可以一劳永逸。&lt;/li&gt;
&lt;li&gt;因为之前两轮技术面都太惨烈，所以这一轮似乎没问太多复杂的问题。这一轮基本上没啥问题了，后面就是BOSS和HR了&lt;/li&gt;
&lt;li&gt;后来又面了一次，主要是谈了一些产品方面的问题，还有我的技术爱好&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&quot;部门BOSS&quot;&gt;&lt;a href=&quot;#部门BOSS&quot; class=&quot;headerlink&quot; title=&quot;部门BOSS&quot;&gt;&lt;/a&gt;部门BOSS&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;主要是问当前工作，手下带了几个兄弟，我说之前是带100多，但我只需要管技术，不用管理。今年开始独立带人，组建团队。感觉很痛苦，要招聘，要带徒弟，要规划产品，还要写代码。&lt;/li&gt;
&lt;li&gt;在产品开发运营过程中的难题，我说最难的就是如何抓住用户的痛点，用平滑的方式解决痛点，不能让用户抵触。&lt;/li&gt;
&lt;li&gt;以及问了我对阿里云某些产品的看法，然后我就说了下对于学习aws的一些心得，顺便吐槽了阿里云。&lt;/li&gt;
&lt;li&gt;再就是介绍他的团队以及产品，还有未来的规划。说了优点也说了缺点，而不像以前接触过的一些光吹牛的面试官。&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&quot;HR&quot;&gt;&lt;a href=&quot;#HR&quot; class=&quot;headerlink&quot; title=&quot;HR&quot;&gt;&lt;/a&gt;HR&lt;/h1&gt;&lt;p&gt;问工作经历，之前每次跳槽的原因。为何想来阿里之类的。&lt;/p&gt;
&lt;h1 id=&quot;HR的BOSS&quot;&gt;&lt;a href=&quot;#HR的BOSS&quot; class=&quot;headerlink&quot; title=&quot;HR的BOSS&quot;&gt;&lt;/a&gt;HR的BOSS&lt;/h1&gt;&lt;p&gt;有点像背景调查，问是否统招啊之类的&lt;/p&gt;
&lt;h1 id=&quot;offer&quot;&gt;&lt;a href=&quot;#offer&quot; class=&quot;headerlink&quot; title=&quot;offer&quot;&gt;&lt;/a&gt;offer&lt;/h1&gt;&lt;p&gt;拿下&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;&lt;code&gt;本博客欢迎转发,但请保留原作者信息&lt;/code&gt;&lt;br&gt;github:&lt;a href=&quot;https://github.com/CodeJuan&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;codejuan&lt;/a&gt;&lt;br&gt;博客地址:&lt;a href=&quot;http://blog.decbug.com/&quot;&gt;http://blog.decbug.com/&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;背景&quot;&gt;&lt;a href=&quot;#背景&quot; class=&quot;headerlink&quot; title=&quot;背景&quot;&gt;&lt;/a&gt;背景&lt;/h1&gt;&lt;p&gt;之前一直都在通信行业撸代码，做的都是C/C++，感觉提升不大，所以打算往互联网转型，看看百万千万用户的产品是如何做出来的。&lt;br&gt;于是在拉勾上投了阿里云。&lt;/p&gt;
    
    </summary>
    
      <category term="code" scheme="http://blog.decbug.com/categories/code/"/>
    
    
      <category term="career" scheme="http://blog.decbug.com/tags/career/"/>
    
      <category term="interview" scheme="http://blog.decbug.com/tags/interview/"/>
    
  </entry>
  
  <entry>
    <title>京东面试经历</title>
    <link href="http://blog.decbug.com/2016/04/10/interview_jd/"/>
    <id>http://blog.decbug.com/2016/04/10/interview_jd/</id>
    <published>2016-04-09T16:00:00.000Z</published>
    <updated>2016-06-29T13:21:22.619Z</updated>
    
    <content type="html">&lt;h1 id=&quot;京东云面试记录&quot;&gt;&lt;a href=&quot;#京东云面试记录&quot; class=&quot;headerlink&quot; title=&quot;京东云面试记录&quot;&gt;&lt;/a&gt;京东云面试记录&lt;/h1&gt;&lt;p&gt;从通信行业转型到互联网，对云，分布式，高并发感兴趣，想搞底层。&lt;br&gt;于是在拉勾投了京东云。&lt;br&gt;面试分4轮，四位面试官分别是架构师、部门老大、大boss 、hr。&lt;br&gt;&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;总体感觉，面试官都很友善，我平时比较不善言语，这次在面试官的引导之下，交流比较顺畅。&lt;/p&gt;
&lt;h1 id=&quot;架构师&quot;&gt;&lt;a href=&quot;#架构师&quot; class=&quot;headerlink&quot; title=&quot;架构师&quot;&gt;&lt;/a&gt;架构师&lt;/h1&gt;&lt;p&gt;先开始闲聊，平时看哪些技术网站啊，我说我是面向GitHub so 谷歌编程，然后聊了聊番茄手段，我说自己弄vps ，家里的路由。之后进入正题，问的问题比较偏原理。比如&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;linux的文件权限是如何实现的，&lt;/li&gt;
&lt;li&gt;一个hello world程序是如何运行起来的（我回答先把可执行文件加载到进程的代码段，之后执行，然后我讲了讲进程地址空间的一些事，感觉面试官对我的回答不太满意。经提醒，我才明白是要讲fork，我大概说了下，可惜忘了说写时复制。&lt;/li&gt;
&lt;li&gt;磁盘空间有空余，然而创建文件失败，是什么原因。我开始没答上来，然后就提示我是否知道，我说可以理解为索引。但还没答上来，后来架构师告诉我是inode space 不足。&lt;/li&gt;
&lt;li&gt;设计一个系统，restful 接口，｛num ，返回对应的斐波纳契数组。我说先实现功能，不能用递归，栈溢出就惨了。日志的话，我说可以玩elk（因为我刚在家玩了下），但面试官想听到日志轮转，我回答一般日志库都可以设置单个文件上限，达到这个值就会创建新文件。还有选型，我说最近用了gorilla mux 。经提醒，我还忘了异常保护。还忘了，可以把每次结果缓存到redis中，如果下次有同样的请求，就可以从redis中直接取值并返回，这样性能会高。&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;总体来说，我没答好。但好在我在提醒之下都能跟上思路，所以勉强过关了吧。&lt;/p&gt;
&lt;h1 id=&quot;部门老大&quot;&gt;&lt;a href=&quot;#部门老大&quot; class=&quot;headerlink&quot; title=&quot;部门老大&quot;&gt;&lt;/a&gt;部门老大&lt;/h1&gt;&lt;p&gt;先是简单聊了聊之前的项目经验，这个就不赘述了。之后是两个系统设计问题&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;设计一个用户登录注册系统。我说先来一个最简单的，单表单应用。当用户多了，就水平扩展服务，把服务发现做好，因为服务是无状态的。如果数据库有压力，就分表。由于用户系统可能是读取多于写入，所以可以搞写库，多个读库。写库可以加主备。最好再加个用户登录行为分析，如果突然变了地理位置，可以警告。这个是我看到的常用套路，也不知道面试官是否满意。&lt;/li&gt;
&lt;li&gt;设计一个电梯系统。我说我做开发的一般喜欢先用一个简单粗暴的方法完成功能。我说记录每个电梯的运行状态，以及个楼层有坐电梯的请求，是到哪一层，可以放到请求列表。遍历列表，找到最近的电梯，然后调度过来。之后再统计电梯的运行数据，找出规律，比如上班高峰期，下班高峰期该如何调度。后来面试官问到如何让电梯的运行负载都均衡，我说暂时没有好的办法，我会给每个电梯设置一个角色，然后每天定时给电梯的角色互换。虽然某一天某个电梯会特别忙，但总体来看，负载会是均衡的。&lt;br&gt;偏理论的东西居多，我看过的书也发挥作用了。对了，最后还问我最近看了啥书，我说正在读第二遍性能之巅。&lt;/li&gt;
&lt;/ol&gt;
&lt;h1 id=&quot;大boss&quot;&gt;&lt;a href=&quot;#大boss&quot; class=&quot;headerlink&quot; title=&quot;大boss&quot;&gt;&lt;/a&gt;大boss&lt;/h1&gt;&lt;p&gt;问的问题是偏团队管理，人员培养，以及产品落地的问题。&lt;br&gt;我说我觉得招聘很难，招到合适的人不容易，招人的标准已经降低了，只要脑子灵活，工作认真，就可以。因为一个人工作不负责，就需要周围的人给他填坑，严重影响团队。关于人员培养，我说我喜欢主动学习，独立解决问题的人，并且会分享的同学，这样团队的技术氛围好了，大家水平提高很快，刻意的培训其实价值不大。产品落地，需要抓住用户的痛点，我们的产品能给用户带来收益，大家双赢。后来问我最近工作中的困惑，我说最近对于项目进度的把控做的不好，组里小伙子干活比较慢，我前端不熟，对于这个进度不知是否合理，我不喜欢逼着小伙子们加班，说白了还是我的技术水平不够，还需要积累。如果我确定这个速度不合理，就可以硬下心肠给小伙子们压力了。&lt;/p&gt;
&lt;h1 id=&quot;hr&quot;&gt;&lt;a href=&quot;#hr&quot; class=&quot;headerlink&quot; title=&quot;hr&quot;&gt;&lt;/a&gt;hr&lt;/h1&gt;&lt;p&gt;问工作经历，教育背景，离职原因，当前薪资，期望薪资等等&lt;/p&gt;
&lt;h1 id=&quot;offer&quot;&gt;&lt;a href=&quot;#offer&quot; class=&quot;headerlink&quot; title=&quot;offer&quot;&gt;&lt;/a&gt;offer&lt;/h1&gt;&lt;p&gt;拿下。&lt;br&gt;然后之前一直都是通信行业，写C写C++，虽然号称全栈，会很多语言，做过很多领域。但和互联网产品的差异还是很大的，没有相关工作背景，被压价是不可避免的。还得继续努力啊。&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;&lt;code&gt;本博客欢迎转发,但请保留原作者信息&lt;/code&gt;&lt;br&gt;github:&lt;a href=&quot;https://github.com/CodeJuan&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;codejuan&lt;/a&gt;&lt;br&gt;博客地址:&lt;a href=&quot;http://blog.decbug.com/&quot;&gt;http://blog.decbug.com/&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;京东云面试记录&quot;&gt;&lt;a href=&quot;#京东云面试记录&quot; class=&quot;headerlink&quot; title=&quot;京东云面试记录&quot;&gt;&lt;/a&gt;京东云面试记录&lt;/h1&gt;&lt;p&gt;从通信行业转型到互联网，对云，分布式，高并发感兴趣，想搞底层。&lt;br&gt;于是在拉勾投了京东云。&lt;br&gt;面试分4轮，四位面试官分别是架构师、部门老大、大boss 、hr。&lt;br&gt;
    
    </summary>
    
      <category term="code" scheme="http://blog.decbug.com/categories/code/"/>
    
    
      <category term="career" scheme="http://blog.decbug.com/tags/career/"/>
    
      <category term="interview" scheme="http://blog.decbug.com/tags/interview/"/>
    
  </entry>
  
  <entry>
    <title>docker(6)-swarm</title>
    <link href="http://blog.decbug.com/2016/03/27/docker_swarm/"/>
    <id>http://blog.decbug.com/2016/03/27/docker_swarm/</id>
    <published>2016-03-26T16:00:00.000Z</published>
    <updated>2016-06-29T13:21:22.619Z</updated>
    
    <content type="html">&lt;h1 id=&quot;背景&quot;&gt;&lt;a href=&quot;#背景&quot; class=&quot;headerlink&quot; title=&quot;背景&quot;&gt;&lt;/a&gt;背景&lt;/h1&gt;&lt;p&gt;正在撸自己的容器云，目前的业务不是复杂，所以做法比较土：自己管理集群，调用每个节点的docker daemon remote API来创建/启动/停止/删除镜像及容器，虽然简单，但是需要自己做集群管理（都还没上服务发现），比较麻烦。&lt;br&gt;此后打算用k8s，但由于其他原因，暂时搁置。后来咨询swarm的maintainer线超博，以及DaoCloud的高手们，决定采用swarm&lt;br&gt;&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&quot;采用swarm的原因&quot;&gt;&lt;a href=&quot;#采用swarm的原因&quot; class=&quot;headerlink&quot; title=&quot;采用swarm的原因&quot;&gt;&lt;/a&gt;采用swarm的原因&lt;/h1&gt;&lt;ol&gt;
&lt;li&gt;自带服务发现，不用我自己弄&lt;/li&gt;
&lt;li&gt;和docker daemon remote API的基本相同，仅有的差异请参照&lt;a href=&quot;https://github.com/CodeJuan/swarm/blob/master/docs/swarm-api.md#endpoints-which-behave-differently&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;官方文档&lt;/a&gt;，基本可以复用原来的代码&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;虽然这次用了swarm，但有机会的话我还是想会继续安利k8s，毕竟k8s更好玩一些&lt;/p&gt;
&lt;h1 id=&quot;安装&quot;&gt;&lt;a href=&quot;#安装&quot; class=&quot;headerlink&quot; title=&quot;安装&quot;&gt;&lt;/a&gt;安装&lt;/h1&gt;&lt;h2 id=&quot;节点分配&quot;&gt;&lt;a href=&quot;#节点分配&quot; class=&quot;headerlink&quot; title=&quot;节点分配&quot;&gt;&lt;/a&gt;节点分配&lt;/h2&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;主机名&lt;/th&gt;
&lt;th&gt;IP&lt;/th&gt;
&lt;th&gt;角色&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;i3&lt;/td&gt;
&lt;td&gt;192.168.1.245&lt;/td&gt;
&lt;td&gt;sonsul,manage0,node&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;g540&lt;/td&gt;
&lt;td&gt;192.168.1.148&lt;/td&gt;
&lt;td&gt;manage1,node&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;g640&lt;/td&gt;
&lt;td&gt;192.168.1.241&lt;/td&gt;
&lt;td&gt;node&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;g530&lt;/td&gt;
&lt;td&gt;192.168.1.173&lt;/td&gt;
&lt;td&gt;node&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;这里的主机名，都是我的机器的CPU型号，这几台机器都是我收购来的二手台式机，IP是openwrt自动分配的，貌似是hash算出来的，是个固定值。&lt;/p&gt;
&lt;h2 id=&quot;暴露docker-daemon的端口&quot;&gt;&lt;a href=&quot;#暴露docker-daemon的端口&quot; class=&quot;headerlink&quot; title=&quot;暴露docker daemon的端口&quot;&gt;&lt;/a&gt;暴露docker daemon的端口&lt;/h2&gt;&lt;p&gt;swarm应该也是调用每个节点的remote API吧，所以需要暴露端口&lt;/p&gt;
&lt;p&gt;打开&lt;code&gt;/etc/default/docker&lt;/code&gt;，在&lt;code&gt;DOCKER_OPTS&lt;/code&gt;加上&lt;br&gt;&lt;figure class=&quot;highlight haml&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;-&lt;span class=&quot;ruby&quot;&gt;&lt;span class=&quot;constant&quot;&gt;H&lt;/span&gt; &lt;span class=&quot;symbol&quot;&gt;tcp:&lt;/span&gt;/&lt;span class=&quot;regexp&quot;&gt;/0.0.0.0:4243 -H unix:/&lt;/span&gt;&lt;span class=&quot;regexp&quot;&gt;//var&lt;/span&gt;&lt;span class=&quot;regexp&quot;&gt;/run/docker&lt;/span&gt;.sock&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;记住这个暴露的端口号，后面会用到，我这里是4243&lt;/p&gt;
&lt;h2 id=&quot;启动consul&quot;&gt;&lt;a href=&quot;#启动consul&quot; class=&quot;headerlink&quot; title=&quot;启动consul&quot;&gt;&lt;/a&gt;启动consul&lt;/h2&gt;&lt;p&gt;在i3上执行&lt;br&gt;&lt;figure class=&quot;highlight stata&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;docker &lt;span class=&quot;keyword&quot;&gt;run&lt;/span&gt; --restart always -&lt;span class=&quot;keyword&quot;&gt;d&lt;/span&gt; -p 8500:8500 --name=consul progrium/consul -server -&lt;span class=&quot;keyword&quot;&gt;bootstrap&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;启动consul，端口是8500&lt;/p&gt;
&lt;h2 id=&quot;启动manager0&quot;&gt;&lt;a href=&quot;#启动manager0&quot; class=&quot;headerlink&quot; title=&quot;启动manager0&quot;&gt;&lt;/a&gt;启动manager0&lt;/h2&gt;&lt;p&gt;还是i3&lt;br&gt;&lt;figure class=&quot;highlight cpp&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;docker run --restart always -d -p &lt;span class=&quot;number&quot;&gt;4000&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;4000&lt;/span&gt; swarm manage -H :&lt;span class=&quot;number&quot;&gt;4000&lt;/span&gt; --replication --advertise &lt;span class=&quot;number&quot;&gt;192.168&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.1&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.245&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;4000&lt;/span&gt; consul:&lt;span class=&quot;comment&quot;&gt;//192.168.1.245:8500&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;advertise的IP就是i3自身的IP，相当于告诉consul，我是manage，这是我的IP和端口&lt;br&gt;consul就是之前在i3上创建的consul的IP和端口&lt;/p&gt;
&lt;h2 id=&quot;启动manager1&quot;&gt;&lt;a href=&quot;#启动manager1&quot; class=&quot;headerlink&quot; title=&quot;启动manager1&quot;&gt;&lt;/a&gt;启动manager1&lt;/h2&gt;&lt;p&gt;官网把这个叫&lt;code&gt;secondary Swarm manager&lt;/code&gt;，领会精神即可&lt;br&gt;这次是在g540上执行&lt;br&gt;&lt;figure class=&quot;highlight cpp&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;docker run --restart always -d swarm manage -H :&lt;span class=&quot;number&quot;&gt;4000&lt;/span&gt; --replication --advertise &lt;span class=&quot;number&quot;&gt;192.168&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.1&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.148&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;4000&lt;/span&gt; consul:&lt;span class=&quot;comment&quot;&gt;//192.168.1.245:8500&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;consul，还是i3上运行的consul&lt;br&gt;advertise 是manager1，也就是自己的IP和端口&lt;/p&gt;
&lt;h2 id=&quot;启动node&quot;&gt;&lt;a href=&quot;#启动node&quot; class=&quot;headerlink&quot; title=&quot;启动node&quot;&gt;&lt;/a&gt;启动node&lt;/h2&gt;&lt;p&gt;在4个节点上分别运行&lt;br&gt;&lt;figure class=&quot;highlight groovy&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;docker run --restart always -d swarm join --advertise=自己的&lt;span class=&quot;string&quot;&gt;IP:&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;4243&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;consul:&lt;/span&gt;&lt;span class=&quot;comment&quot;&gt;//192.168.1.245:8500&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;这里的4243就是之前暴露的docker daemon的端口了&lt;/p&gt;
&lt;h2 id=&quot;在i3上查看info&quot;&gt;&lt;a href=&quot;#在i3上查看info&quot; class=&quot;headerlink&quot; title=&quot;在i3上查看info&quot;&gt;&lt;/a&gt;在i3上查看info&lt;/h2&gt;&lt;figure class=&quot;highlight nginx&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;title&quot;&gt;docker&lt;/span&gt; -H :&lt;span class=&quot;number&quot;&gt;4000&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;info&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;这里表示，docker会向本机的4000端口发请求，也就是我们最开始启动manager0的时候声明的端口。&lt;br&gt;可以看到&lt;br&gt;&lt;figure class=&quot;highlight cpp&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;Containers: &lt;span class=&quot;number&quot;&gt;19&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; Running: &lt;span class=&quot;number&quot;&gt;19&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; Paused: &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; Stopped: &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Images: &lt;span class=&quot;number&quot;&gt;26&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Server Version: swarm/&lt;span class=&quot;number&quot;&gt;1.1&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.3&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Role: primary&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Strategy: spread&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Filters: health, port, dependency, affinity, constraint&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Nodes: &lt;span class=&quot;number&quot;&gt;4&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; g530: &lt;span class=&quot;number&quot;&gt;192.168&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.1&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.173&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;4243&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  └ Status: Healthy&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  └ Containers: &lt;span class=&quot;number&quot;&gt;8&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  └ Reserved CPUs: &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt; / &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  └ Reserved Memory: &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt; B / &lt;span class=&quot;number&quot;&gt;3.969&lt;/span&gt; GiB&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  └ Labels: executiondriver=native-&lt;span class=&quot;number&quot;&gt;0.2&lt;/span&gt;, kernelversion=&lt;span class=&quot;number&quot;&gt;3.19&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.0&lt;/span&gt;-&lt;span class=&quot;number&quot;&gt;25&lt;/span&gt;-generic, operatingsystem=Ubuntu &lt;span class=&quot;number&quot;&gt;14.04&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.3&lt;/span&gt; LTS, storagedriver=aufs&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  └ Error: (none)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  └ UpdatedAt: &lt;span class=&quot;number&quot;&gt;2016&lt;/span&gt;-&lt;span class=&quot;number&quot;&gt;03&lt;/span&gt;-&lt;span class=&quot;number&quot;&gt;27&lt;/span&gt;T09:&lt;span class=&quot;number&quot;&gt;46&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;45&lt;/span&gt;Z&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; g540: &lt;span class=&quot;number&quot;&gt;192.168&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.1&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.148&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;4243&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  └ Status: Healthy&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  └ Containers: &lt;span class=&quot;number&quot;&gt;4&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  └ Reserved CPUs: &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt; / &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  └ Reserved Memory: &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt; B / &lt;span class=&quot;number&quot;&gt;3.93&lt;/span&gt; GiB&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  └ Labels: executiondriver=native-&lt;span class=&quot;number&quot;&gt;0.2&lt;/span&gt;, kernelversion=&lt;span class=&quot;number&quot;&gt;3.19&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.0&lt;/span&gt;-&lt;span class=&quot;number&quot;&gt;25&lt;/span&gt;-generic, operatingsystem=Ubuntu &lt;span class=&quot;number&quot;&gt;14.04&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.4&lt;/span&gt; LTS, storagedriver=aufs&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  └ Error: (none)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  └ UpdatedAt: &lt;span class=&quot;number&quot;&gt;2016&lt;/span&gt;-&lt;span class=&quot;number&quot;&gt;03&lt;/span&gt;-&lt;span class=&quot;number&quot;&gt;27&lt;/span&gt;T09:&lt;span class=&quot;number&quot;&gt;47&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;02&lt;/span&gt;Z&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; g640: &lt;span class=&quot;number&quot;&gt;192.168&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.1&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.241&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;4243&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  └ Status: Healthy&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  └ Containers: &lt;span class=&quot;number&quot;&gt;4&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  └ Reserved CPUs: &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt; / &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  └ Reserved Memory: &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt; B / &lt;span class=&quot;number&quot;&gt;3.739&lt;/span&gt; GiB&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  └ Labels: executiondriver=native-&lt;span class=&quot;number&quot;&gt;0.2&lt;/span&gt;, kernelversion=&lt;span class=&quot;number&quot;&gt;3.19&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.0&lt;/span&gt;-&lt;span class=&quot;number&quot;&gt;25&lt;/span&gt;-generic, operatingsystem=Ubuntu &lt;span class=&quot;number&quot;&gt;14.04&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.4&lt;/span&gt; LTS, storagedriver=aufs&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  └ Error: (none)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  └ UpdatedAt: &lt;span class=&quot;number&quot;&gt;2016&lt;/span&gt;-&lt;span class=&quot;number&quot;&gt;03&lt;/span&gt;-&lt;span class=&quot;number&quot;&gt;27&lt;/span&gt;T09:&lt;span class=&quot;number&quot;&gt;46&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;56&lt;/span&gt;Z&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; i3: &lt;span class=&quot;number&quot;&gt;192.168&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.1&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.245&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;4243&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  └ Status: Healthy&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  └ Containers: &lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  └ Reserved CPUs: &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt; / &lt;span class=&quot;number&quot;&gt;4&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  └ Reserved Memory: &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt; B / &lt;span class=&quot;number&quot;&gt;16.12&lt;/span&gt; GiB&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  └ Labels: executiondriver=native-&lt;span class=&quot;number&quot;&gt;0.2&lt;/span&gt;, kernelversion=&lt;span class=&quot;number&quot;&gt;3.19&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.0&lt;/span&gt;-&lt;span class=&quot;number&quot;&gt;25&lt;/span&gt;-generic, operatingsystem=Ubuntu &lt;span class=&quot;number&quot;&gt;14.04&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.3&lt;/span&gt; LTS, storagedriver=aufs&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  └ Error: (none)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  └ UpdatedAt: &lt;span class=&quot;number&quot;&gt;2016&lt;/span&gt;-&lt;span class=&quot;number&quot;&gt;03&lt;/span&gt;-&lt;span class=&quot;number&quot;&gt;27&lt;/span&gt;T09:&lt;span class=&quot;number&quot;&gt;47&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;17&lt;/span&gt;Z&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Plugins:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; Volume:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; Network:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Kernel Version: &lt;span class=&quot;number&quot;&gt;3.19&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.0&lt;/span&gt;-&lt;span class=&quot;number&quot;&gt;25&lt;/span&gt;-generic&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Operating System: linux&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Architecture: amd64&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;CPUs: &lt;span class=&quot;number&quot;&gt;10&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Total Memory: &lt;span class=&quot;number&quot;&gt;27.76&lt;/span&gt; GiB&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;很帅吧&lt;/p&gt;
&lt;h1 id=&quot;测试&quot;&gt;&lt;a href=&quot;#测试&quot; class=&quot;headerlink&quot; title=&quot;测试&quot;&gt;&lt;/a&gt;测试&lt;/h1&gt;&lt;h2 id=&quot;获取当前正在运行的容器&quot;&gt;&lt;a href=&quot;#获取当前正在运行的容器&quot; class=&quot;headerlink&quot; title=&quot;获取当前正在运行的容器&quot;&gt;&lt;/a&gt;获取当前正在运行的容器&lt;/h2&gt;&lt;figure class=&quot;highlight groovy&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;curl -X GET &lt;span class=&quot;string&quot;&gt;http:&lt;/span&gt;&lt;span class=&quot;comment&quot;&gt;//192.168.1.245:4000/containers/json&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;返回&lt;br&gt;&lt;figure class=&quot;highlight json&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;59&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;60&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;61&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;62&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;63&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;64&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;65&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;66&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;67&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;68&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;69&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;70&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;71&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;72&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;73&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;74&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;75&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;76&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;77&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;78&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;79&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;80&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;81&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;82&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;83&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;84&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;85&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;86&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;87&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;88&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;89&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;90&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;91&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;[&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &quot;&lt;span class=&quot;attribute&quot;&gt;Id&lt;/span&gt;&quot;:&lt;span class=&quot;value&quot;&gt;&lt;span class=&quot;string&quot;&gt;&quot;b7919e7e49b1fc580f046734ab6eba53435200a9b07a1f75b176afe6663ee573&quot;&lt;/span&gt;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &quot;&lt;span class=&quot;attribute&quot;&gt;Names&lt;/span&gt;&quot;:&lt;span class=&quot;value&quot;&gt;[&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;string&quot;&gt;&quot;/i3/consul&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ]&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &quot;&lt;span class=&quot;attribute&quot;&gt;Image&lt;/span&gt;&quot;:&lt;span class=&quot;value&quot;&gt;&lt;span class=&quot;string&quot;&gt;&quot;progrium/consul&quot;&lt;/span&gt;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &quot;&lt;span class=&quot;attribute&quot;&gt;Command&lt;/span&gt;&quot;:&lt;span class=&quot;value&quot;&gt;&lt;span class=&quot;string&quot;&gt;&quot;/bin/start -server -bootstrap&quot;&lt;/span&gt;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &quot;&lt;span class=&quot;attribute&quot;&gt;Created&lt;/span&gt;&quot;:&lt;span class=&quot;value&quot;&gt;&lt;span class=&quot;number&quot;&gt;1459070754&lt;/span&gt;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &quot;&lt;span class=&quot;attribute&quot;&gt;Status&lt;/span&gt;&quot;:&lt;span class=&quot;value&quot;&gt;&lt;span class=&quot;string&quot;&gt;&quot;Up About an hour&quot;&lt;/span&gt;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &quot;&lt;span class=&quot;attribute&quot;&gt;Ports&lt;/span&gt;&quot;:&lt;span class=&quot;value&quot;&gt;[&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &quot;&lt;span class=&quot;attribute&quot;&gt;IP&lt;/span&gt;&quot;:&lt;span class=&quot;value&quot;&gt;&lt;span class=&quot;string&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &quot;&lt;span class=&quot;attribute&quot;&gt;PrivatePort&lt;/span&gt;&quot;:&lt;span class=&quot;value&quot;&gt;&lt;span class=&quot;number&quot;&gt;8301&lt;/span&gt;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &quot;&lt;span class=&quot;attribute&quot;&gt;PublicPort&lt;/span&gt;&quot;:&lt;span class=&quot;value&quot;&gt;&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &quot;&lt;span class=&quot;attribute&quot;&gt;Type&lt;/span&gt;&quot;:&lt;span class=&quot;value&quot;&gt;&lt;span class=&quot;string&quot;&gt;&quot;udp&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;/span&gt;&amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &quot;&lt;span class=&quot;attribute&quot;&gt;IP&lt;/span&gt;&quot;:&lt;span class=&quot;value&quot;&gt;&lt;span class=&quot;string&quot;&gt;&quot;192.168.1.245&quot;&lt;/span&gt;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &quot;&lt;span class=&quot;attribute&quot;&gt;PrivatePort&lt;/span&gt;&quot;:&lt;span class=&quot;value&quot;&gt;&lt;span class=&quot;number&quot;&gt;8500&lt;/span&gt;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &quot;&lt;span class=&quot;attribute&quot;&gt;PublicPort&lt;/span&gt;&quot;:&lt;span class=&quot;value&quot;&gt;&lt;span class=&quot;number&quot;&gt;8500&lt;/span&gt;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &quot;&lt;span class=&quot;attribute&quot;&gt;Type&lt;/span&gt;&quot;:&lt;span class=&quot;value&quot;&gt;&lt;span class=&quot;string&quot;&gt;&quot;tcp&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;/span&gt;&amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &quot;&lt;span class=&quot;attribute&quot;&gt;IP&lt;/span&gt;&quot;:&lt;span class=&quot;value&quot;&gt;&lt;span class=&quot;string&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &quot;&lt;span class=&quot;attribute&quot;&gt;PrivatePort&lt;/span&gt;&quot;:&lt;span class=&quot;value&quot;&gt;&lt;span class=&quot;number&quot;&gt;8301&lt;/span&gt;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &quot;&lt;span class=&quot;attribute&quot;&gt;PublicPort&lt;/span&gt;&quot;:&lt;span class=&quot;value&quot;&gt;&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &quot;&lt;span class=&quot;attribute&quot;&gt;Type&lt;/span&gt;&quot;:&lt;span class=&quot;value&quot;&gt;&lt;span class=&quot;string&quot;&gt;&quot;tcp&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;/span&gt;&amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &quot;&lt;span class=&quot;attribute&quot;&gt;IP&lt;/span&gt;&quot;:&lt;span class=&quot;value&quot;&gt;&lt;span class=&quot;string&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &quot;&lt;span class=&quot;attribute&quot;&gt;PrivatePort&lt;/span&gt;&quot;:&lt;span class=&quot;value&quot;&gt;&lt;span class=&quot;number&quot;&gt;8302&lt;/span&gt;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &quot;&lt;span class=&quot;attribute&quot;&gt;PublicPort&lt;/span&gt;&quot;:&lt;span class=&quot;value&quot;&gt;&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &quot;&lt;span class=&quot;attribute&quot;&gt;Type&lt;/span&gt;&quot;:&lt;span class=&quot;value&quot;&gt;&lt;span class=&quot;string&quot;&gt;&quot;udp&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;/span&gt;&amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &quot;&lt;span class=&quot;attribute&quot;&gt;IP&lt;/span&gt;&quot;:&lt;span class=&quot;value&quot;&gt;&lt;span class=&quot;string&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &quot;&lt;span class=&quot;attribute&quot;&gt;PrivatePort&lt;/span&gt;&quot;:&lt;span class=&quot;value&quot;&gt;&lt;span class=&quot;number&quot;&gt;8300&lt;/span&gt;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &quot;&lt;span class=&quot;attribute&quot;&gt;PublicPort&lt;/span&gt;&quot;:&lt;span class=&quot;value&quot;&gt;&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &quot;&lt;span class=&quot;attribute&quot;&gt;Type&lt;/span&gt;&quot;:&lt;span class=&quot;value&quot;&gt;&lt;span class=&quot;string&quot;&gt;&quot;tcp&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;/span&gt;&amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &quot;&lt;span class=&quot;attribute&quot;&gt;IP&lt;/span&gt;&quot;:&lt;span class=&quot;value&quot;&gt;&lt;span class=&quot;string&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &quot;&lt;span class=&quot;attribute&quot;&gt;PrivatePort&lt;/span&gt;&quot;:&lt;span class=&quot;value&quot;&gt;&lt;span class=&quot;number&quot;&gt;53&lt;/span&gt;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &quot;&lt;span class=&quot;attribute&quot;&gt;PublicPort&lt;/span&gt;&quot;:&lt;span class=&quot;value&quot;&gt;&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &quot;&lt;span class=&quot;attribute&quot;&gt;Type&lt;/span&gt;&quot;:&lt;span class=&quot;value&quot;&gt;&lt;span class=&quot;string&quot;&gt;&quot;tcp&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;/span&gt;&amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &quot;&lt;span class=&quot;attribute&quot;&gt;IP&lt;/span&gt;&quot;:&lt;span class=&quot;value&quot;&gt;&lt;span class=&quot;string&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &quot;&lt;span class=&quot;attribute&quot;&gt;PrivatePort&lt;/span&gt;&quot;:&lt;span class=&quot;value&quot;&gt;&lt;span class=&quot;number&quot;&gt;53&lt;/span&gt;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &quot;&lt;span class=&quot;attribute&quot;&gt;PublicPort&lt;/span&gt;&quot;:&lt;span class=&quot;value&quot;&gt;&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &quot;&lt;span class=&quot;attribute&quot;&gt;Type&lt;/span&gt;&quot;:&lt;span class=&quot;value&quot;&gt;&lt;span class=&quot;string&quot;&gt;&quot;udp&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;/span&gt;&amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &quot;&lt;span class=&quot;attribute&quot;&gt;IP&lt;/span&gt;&quot;:&lt;span class=&quot;value&quot;&gt;&lt;span class=&quot;string&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &quot;&lt;span class=&quot;attribute&quot;&gt;PrivatePort&lt;/span&gt;&quot;:&lt;span class=&quot;value&quot;&gt;&lt;span class=&quot;number&quot;&gt;8400&lt;/span&gt;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &quot;&lt;span class=&quot;attribute&quot;&gt;PublicPort&lt;/span&gt;&quot;:&lt;span class=&quot;value&quot;&gt;&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &quot;&lt;span class=&quot;attribute&quot;&gt;Type&lt;/span&gt;&quot;:&lt;span class=&quot;value&quot;&gt;&lt;span class=&quot;string&quot;&gt;&quot;tcp&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;/span&gt;&amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &quot;&lt;span class=&quot;attribute&quot;&gt;IP&lt;/span&gt;&quot;:&lt;span class=&quot;value&quot;&gt;&lt;span class=&quot;string&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &quot;&lt;span class=&quot;attribute&quot;&gt;PrivatePort&lt;/span&gt;&quot;:&lt;span class=&quot;value&quot;&gt;&lt;span class=&quot;number&quot;&gt;8302&lt;/span&gt;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &quot;&lt;span class=&quot;attribute&quot;&gt;PublicPort&lt;/span&gt;&quot;:&lt;span class=&quot;value&quot;&gt;&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &quot;&lt;span class=&quot;attribute&quot;&gt;Type&lt;/span&gt;&quot;:&lt;span class=&quot;value&quot;&gt;&lt;span class=&quot;string&quot;&gt;&quot;tcp&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;/span&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ]&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &quot;&lt;span class=&quot;attribute&quot;&gt;SizeRw&lt;/span&gt;&quot;:&lt;span class=&quot;value&quot;&gt;&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &quot;&lt;span class=&quot;attribute&quot;&gt;SizeRootFs&lt;/span&gt;&quot;:&lt;span class=&quot;value&quot;&gt;&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &quot;&lt;span class=&quot;attribute&quot;&gt;Labels&lt;/span&gt;&quot;:&lt;span class=&quot;value&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &quot;&lt;span class=&quot;attribute&quot;&gt;NetworkSettings&lt;/span&gt;&quot;:&lt;span class=&quot;value&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &quot;&lt;span class=&quot;attribute&quot;&gt;Networks&lt;/span&gt;&quot;:&lt;span class=&quot;value&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &quot;&lt;span class=&quot;attribute&quot;&gt;bridge&lt;/span&gt;&quot;:&lt;span class=&quot;value&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &quot;&lt;span class=&quot;attribute&quot;&gt;IPAMConfig&lt;/span&gt;&quot;:&lt;span class=&quot;value&quot;&gt;&lt;span class=&quot;literal&quot;&gt;null&lt;/span&gt;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &quot;&lt;span class=&quot;attribute&quot;&gt;Links&lt;/span&gt;&quot;:&lt;span class=&quot;value&quot;&gt;&lt;span class=&quot;literal&quot;&gt;null&lt;/span&gt;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &quot;&lt;span class=&quot;attribute&quot;&gt;Aliases&lt;/span&gt;&quot;:&lt;span class=&quot;value&quot;&gt;&lt;span class=&quot;literal&quot;&gt;null&lt;/span&gt;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &quot;&lt;span class=&quot;attribute&quot;&gt;NetworkID&lt;/span&gt;&quot;:&lt;span class=&quot;value&quot;&gt;&lt;span class=&quot;string&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &quot;&lt;span class=&quot;attribute&quot;&gt;EndpointID&lt;/span&gt;&quot;:&lt;span class=&quot;value&quot;&gt;&lt;span class=&quot;string&quot;&gt;&quot;3527825ec17c51e77cfe005a7bf364e2d2b8777dc500cd7554309e855fcc5395&quot;&lt;/span&gt;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &quot;&lt;span class=&quot;attribute&quot;&gt;Gateway&lt;/span&gt;&quot;:&lt;span class=&quot;value&quot;&gt;&lt;span class=&quot;string&quot;&gt;&quot;172.17.0.1&quot;&lt;/span&gt;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &quot;&lt;span class=&quot;attribute&quot;&gt;IPAddress&lt;/span&gt;&quot;:&lt;span class=&quot;value&quot;&gt;&lt;span class=&quot;string&quot;&gt;&quot;172.17.0.2&quot;&lt;/span&gt;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &quot;&lt;span class=&quot;attribute&quot;&gt;IPPrefixLen&lt;/span&gt;&quot;:&lt;span class=&quot;value&quot;&gt;&lt;span class=&quot;number&quot;&gt;16&lt;/span&gt;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &quot;&lt;span class=&quot;attribute&quot;&gt;IPv6Gateway&lt;/span&gt;&quot;:&lt;span class=&quot;value&quot;&gt;&lt;span class=&quot;string&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &quot;&lt;span class=&quot;attribute&quot;&gt;GlobalIPv6Address&lt;/span&gt;&quot;:&lt;span class=&quot;value&quot;&gt;&lt;span class=&quot;string&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &quot;&lt;span class=&quot;attribute&quot;&gt;GlobalIPv6PrefixLen&lt;/span&gt;&quot;:&lt;span class=&quot;value&quot;&gt;&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &quot;&lt;span class=&quot;attribute&quot;&gt;MacAddress&lt;/span&gt;&quot;:&lt;span class=&quot;value&quot;&gt;&lt;span class=&quot;string&quot;&gt;&quot;02:42:ac:11:00:02&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;/span&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;/span&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;/span&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;]&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;可以看到，和以前的remote API获取到的基本相同，只是在IP那里，从&lt;code&gt;0.0.0.0&lt;/code&gt;变成了实际的IP&lt;/p&gt;
&lt;h2 id=&quot;pull一个镜像&quot;&gt;&lt;a href=&quot;#pull一个镜像&quot; class=&quot;headerlink&quot; title=&quot;pull一个镜像&quot;&gt;&lt;/a&gt;pull一个镜像&lt;/h2&gt;&lt;figure class=&quot;highlight groovy&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;curl -X POST &lt;span class=&quot;string&quot;&gt;http:&lt;/span&gt;&lt;span class=&quot;comment&quot;&gt;//192.168.1.245:4000/images/create?fromImage=ubuntu&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;整一个容器试试&quot;&gt;&lt;a href=&quot;#整一个容器试试&quot; class=&quot;headerlink&quot; title=&quot;整一个容器试试&quot;&gt;&lt;/a&gt;整一个容器试试&lt;/h2&gt;&lt;figure class=&quot;highlight dns&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;# 创建&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;curl -X POST -H &quot;Content-Type: application/json&quot; -d &#39;&amp;#123;&quot;Image&quot;:&quot;registry:2.2.1&quot;&amp;#125;&#39; http://&lt;span class=&quot;number&quot;&gt;192.168.1.245&lt;/span&gt;:4000/containers/create&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# 记录返回的id&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# 启动&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#curl -X POST http://&lt;span class=&quot;number&quot;&gt;192.168.1.245&lt;/span&gt;:4000/containers/(id)/start&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;curl -X POST http://&lt;span class=&quot;number&quot;&gt;192.168.1.245&lt;/span&gt;:4000/containers/&lt;span class=&quot;number&quot;&gt;69e61f836&lt;/span&gt;c2fad4cf&lt;span class=&quot;number&quot;&gt;29a0f37c2&lt;/span&gt;b&lt;span class=&quot;number&quot;&gt;4575e267&lt;/span&gt;b&lt;span class=&quot;number&quot;&gt;45c2931737152&lt;/span&gt;ef&lt;span class=&quot;number&quot;&gt;6f40a9d8&lt;/span&gt;a4279/start&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# stop&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;curl -X POST http://&lt;span class=&quot;number&quot;&gt;192.168.1.245&lt;/span&gt;:4000/containers/&lt;span class=&quot;number&quot;&gt;69e61f836&lt;/span&gt;c2fad4cf&lt;span class=&quot;number&quot;&gt;29a0f37c2&lt;/span&gt;b&lt;span class=&quot;number&quot;&gt;4575e267&lt;/span&gt;b&lt;span class=&quot;number&quot;&gt;45c2931737152&lt;/span&gt;ef&lt;span class=&quot;number&quot;&gt;6f40a9d8&lt;/span&gt;a4279/stop&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# remove&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;curl -X DELETE http://&lt;span class=&quot;number&quot;&gt;192.168.1.245&lt;/span&gt;:4000/containers/&lt;span class=&quot;number&quot;&gt;69e61f836&lt;/span&gt;c2fad4cf&lt;span class=&quot;number&quot;&gt;29a0f37c2&lt;/span&gt;b&lt;span class=&quot;number&quot;&gt;4575e267&lt;/span&gt;b&lt;span class=&quot;number&quot;&gt;45c2931737152&lt;/span&gt;ef&lt;span class=&quot;number&quot;&gt;6f40a9d8&lt;/span&gt;a4279?v=1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;hr&gt;
&lt;p&gt;&lt;code&gt;本博客欢迎转发,但请保留原作者信息&lt;/code&gt;&lt;br&gt;github:&lt;a href=&quot;https://github.com/CodeJuan&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;codejuan&lt;/a&gt;&lt;br&gt;博客地址:&lt;a href=&quot;http://blog.decbug.com/&quot;&gt;http://blog.decbug.com/&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;背景&quot;&gt;&lt;a href=&quot;#背景&quot; class=&quot;headerlink&quot; title=&quot;背景&quot;&gt;&lt;/a&gt;背景&lt;/h1&gt;&lt;p&gt;正在撸自己的容器云，目前的业务不是复杂，所以做法比较土：自己管理集群，调用每个节点的docker daemon remote API来创建/启动/停止/删除镜像及容器，虽然简单，但是需要自己做集群管理（都还没上服务发现），比较麻烦。&lt;br&gt;此后打算用k8s，但由于其他原因，暂时搁置。后来咨询swarm的maintainer线超博，以及DaoCloud的高手们，决定采用swarm&lt;br&gt;
    
    </summary>
    
      <category term="code" scheme="http://blog.decbug.com/categories/code/"/>
    
    
      <category term="docker" scheme="http://blog.decbug.com/tags/docker/"/>
    
      <category term="docker-swarm" scheme="http://blog.decbug.com/tags/docker-swarm/"/>
    
  </entry>
  
  <entry>
    <title>docker(5)-kubernetes</title>
    <link href="http://blog.decbug.com/2016/02/28/docker_kubernetes/"/>
    <id>http://blog.decbug.com/2016/02/28/docker_kubernetes/</id>
    <published>2016-02-27T16:00:00.000Z</published>
    <updated>2016-06-29T13:21:22.619Z</updated>
    
    <content type="html">&lt;h1 id=&quot;背景&quot;&gt;&lt;a href=&quot;#背景&quot; class=&quot;headerlink&quot; title=&quot;背景&quot;&gt;&lt;/a&gt;背景&lt;/h1&gt;&lt;p&gt;需要做一个容器云，有同事在撸mesos+marathon+chronos，我就顺便折腾下kubernetes。&lt;br&gt;&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&quot;kubernetes简介&quot;&gt;&lt;a href=&quot;#kubernetes简介&quot; class=&quot;headerlink&quot; title=&quot;kubernetes简介&quot;&gt;&lt;/a&gt;kubernetes简介&lt;/h1&gt;&lt;blockquote&gt;
&lt;p&gt;Kubernetes是Google开源的容器集群管理系统。它构建Ddocker技术之上，为容器化的应用提供资源调度、部署运行、服务发现、扩容缩容等整一套功能&lt;/p&gt;
&lt;p&gt;Kubernetes 是来自 Google 云平台的开源容器集群管理系统。基于 Docker 构建一个容器的调度服务。该系统可以自动在一个容器集群中选择一个工作容器供使用。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;感觉像是Docker版PaaS版的OpenStack。OpenStack对外提供VM，Kubernetes则对外提供基于docker的服务。&lt;/p&gt;
&lt;h1 id=&quot;通过ansible装docker&quot;&gt;&lt;a href=&quot;#通过ansible装docker&quot; class=&quot;headerlink&quot; title=&quot;通过ansible装docker&quot;&gt;&lt;/a&gt;通过ansible装docker&lt;/h1&gt;&lt;p&gt;机器多了，再手工装docker-engine就太麻烦了，所以写个playbook，给家里的机器统一安装。&lt;br&gt;代码放在&lt;a href=&quot;https://github.com/CodeJuan/kubernetes_practice&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://github.com/CodeJuan/kubernetes_practice&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;hosts&quot;&gt;&lt;a href=&quot;#hosts&quot; class=&quot;headerlink&quot; title=&quot;hosts&quot;&gt;&lt;/a&gt;hosts&lt;/h2&gt;&lt;figure class=&quot;highlight cpp&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;[master]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;i3	ansible_user=i3	ansible_ssh_host=&lt;span class=&quot;number&quot;&gt;192.168&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.1&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.245&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[million]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;g530	ansible_user=g530	ansible_ssh_host=&lt;span class=&quot;number&quot;&gt;192.168&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.1&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.173&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;g540	ansible_user=g540	ansible_ssh_host=&lt;span class=&quot;number&quot;&gt;192.168&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.1&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.148&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;g640	ansible_user=g640	ansible_ssh_host=&lt;span class=&quot;number&quot;&gt;192.168&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.1&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.241&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;如果没有添加SSH key，那么可以设置ansible_ssh_pass=xxxxxx&lt;/p&gt;
&lt;p&gt;这里说一个奇葩的事情，重装了系统之后，手动把maset的pubkey添加到agent的可信ssh里，然而在play的时候总提示&lt;code&gt;没有权限&lt;/code&gt;，尝试了各种方法依旧无解。&lt;br&gt;最后死马当活马医，&lt;code&gt;pip uninstall ansible&lt;/code&gt;再&lt;code&gt;pip install&lt;/code&gt;，竟然就好了，实在是很无语。&lt;/p&gt;
&lt;h2 id=&quot;playbooks&quot;&gt;&lt;a href=&quot;#playbooks&quot; class=&quot;headerlink&quot; title=&quot;playbooks&quot;&gt;&lt;/a&gt;playbooks&lt;/h2&gt;&lt;figure class=&quot;highlight haml&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;-&lt;span class=&quot;ruby&quot;&gt;--&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;-&lt;span class=&quot;ruby&quot;&gt; &lt;span class=&quot;symbol&quot;&gt;hosts:&lt;/span&gt; all &lt;span class=&quot;comment&quot;&gt;#表示hosts里的所有agent都要装&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;  tasks:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  -&lt;span class=&quot;ruby&quot;&gt; &lt;span class=&quot;symbol&quot;&gt;name:&lt;/span&gt; ping &lt;span class=&quot;comment&quot;&gt;# 先测试是否能ping通&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;    ping:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  -&lt;span class=&quot;ruby&quot;&gt; &lt;span class=&quot;symbol&quot;&gt;name:&lt;/span&gt; add_docker_key &lt;span class=&quot;comment&quot;&gt;# 加入key&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;    sudo: yes&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    command: apt-key adv --keyserver hkp://p80.pool.sks-keyservers.net:80 --recv-keys 58118E89F3A912897C070ADBF76221572C52609D&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  -&lt;span class=&quot;ruby&quot;&gt; &lt;span class=&quot;symbol&quot;&gt;name:&lt;/span&gt; update_apt_source &lt;span class=&quot;comment&quot;&gt;# 增加源&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;    sudo: yes&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    lineinfile:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      dest=/etc/apt/sources.list.d/docker.list&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      create=yes&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      line=&quot;deb https://apt.dockerproject.org/repo ubuntu-trusty main&quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  -&lt;span class=&quot;ruby&quot;&gt; &lt;span class=&quot;symbol&quot;&gt;name:&lt;/span&gt; install docker&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;    sudo: yes&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    apt: name=docker-engine update_cache=yes&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;执行&quot;&gt;&lt;a href=&quot;#执行&quot; class=&quot;headerlink&quot; title=&quot;执行&quot;&gt;&lt;/a&gt;执行&lt;/h2&gt;&lt;figure class=&quot;highlight sh&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;ansible-playbook -i hosts playbook.yml -K&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;其中-K表示，交互式的输入sudo密码&lt;br&gt;&lt;img src=&quot;https://github.com/CodeJuan/codejuan.github.io/raw/master/images/blog/docker/ansible_install_docker.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;稍等片刻，每个agent的docker-engine就都安装好了。接下来就是安装kubernetes&lt;/p&gt;
&lt;h1 id=&quot;安装kubernetes&quot;&gt;&lt;a href=&quot;#安装kubernetes&quot; class=&quot;headerlink&quot; title=&quot;安装kubernetes&quot;&gt;&lt;/a&gt;安装kubernetes&lt;/h1&gt;&lt;p&gt;&lt;a href=&quot;http://kubernetes.io/v1.1/docs/getting-started-guides/locally.html#linux&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://kubernetes.io/v1.1/docs/getting-started-guides/locally.html#linux&lt;/a&gt;&lt;br&gt;参照谷歌的文档安装一下。&lt;/p&gt;
&lt;h2 id=&quot;安装go&quot;&gt;&lt;a href=&quot;#安装go&quot; class=&quot;headerlink&quot; title=&quot;安装go&quot;&gt;&lt;/a&gt;安装go&lt;/h2&gt;&lt;p&gt;&lt;a href=&quot;http://blog.decbug.com/2015/11/28/golang/&quot;&gt;http://blog.decbug.com/2015/11/28/golang/&lt;/a&gt;&lt;br&gt;参考之前写的安装一下，要不要翻译成Ansible呢。。。。。。&lt;/p&gt;
&lt;h2 id=&quot;etcd&quot;&gt;&lt;a href=&quot;#etcd&quot; class=&quot;headerlink&quot; title=&quot;etcd&quot;&gt;&lt;/a&gt;etcd&lt;/h2&gt;&lt;figure class=&quot;highlight sh&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;curl -L  https://github.com/coreos/etcd/releases/download/v2.&lt;span class=&quot;number&quot;&gt;2.4&lt;/span&gt;/etcd-v2.&lt;span class=&quot;number&quot;&gt;2.4&lt;/span&gt;-linux-amd64.tar.gz -o etcd-v2.&lt;span class=&quot;number&quot;&gt;2.4&lt;/span&gt;-linux-amd64.tar.gz&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;tar -C /usr/&lt;span class=&quot;built_in&quot;&gt;local&lt;/span&gt;/ -xzvf etcd-v2.&lt;span class=&quot;number&quot;&gt;2.4&lt;/span&gt;-linux-amd64.tar.gz&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;cd&lt;/span&gt; etcd-v2.&lt;span class=&quot;number&quot;&gt;2.4&lt;/span&gt;-linux-amd64&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;./etcd&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;k8s&quot;&gt;&lt;a href=&quot;#k8s&quot; class=&quot;headerlink&quot; title=&quot;k8s&quot;&gt;&lt;/a&gt;k8s&lt;/h2&gt;&lt;figure class=&quot;highlight sh&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;sudo tar -C /usr/&lt;span class=&quot;built_in&quot;&gt;local&lt;/span&gt;/ -xvzf kubernetes.tar.gz&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;a href=&quot;http://kubernetes.io/v1.0/docs/getting-started-guides/ubuntu.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://kubernetes.io/v1.0/docs/getting-started-guides/ubuntu.html&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;部署&quot;&gt;&lt;a href=&quot;#部署&quot; class=&quot;headerlink&quot; title=&quot;部署&quot;&gt;&lt;/a&gt;部署&lt;/h2&gt;&lt;figure class=&quot;highlight cpp&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;preprocessor&quot;&gt;### 设置环境变量&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;export&lt;/span&gt; FLANNEL_VERSION=&lt;span class=&quot;number&quot;&gt;0.5&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.5&lt;/span&gt; &amp;amp;&amp;amp; &lt;span class=&quot;keyword&quot;&gt;export&lt;/span&gt; ETCD_VERSION=&lt;span class=&quot;number&quot;&gt;2.2&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.5&lt;/span&gt; &amp;amp;&amp;amp; &lt;span class=&quot;keyword&quot;&gt;export&lt;/span&gt; KUBE_VERSION=&lt;span class=&quot;number&quot;&gt;1.1&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.8&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;build&quot;&gt;&lt;a href=&quot;#build&quot; class=&quot;headerlink&quot; title=&quot;build&quot;&gt;&lt;/a&gt;build&lt;/h3&gt;&lt;p&gt;执行&lt;code&gt;kubernetes/cluster/ubuntu/build.sh&lt;/code&gt;，会自动下载二进制，然而。。。。&lt;br&gt;&lt;figure class=&quot;highlight cpp&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;Prepare flannel &lt;span class=&quot;number&quot;&gt;0.4&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.0&lt;/span&gt; release ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                 Dload  Upload   Total   Spent    Left  Speed&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;number&quot;&gt;100&lt;/span&gt;   &lt;span class=&quot;number&quot;&gt;608&lt;/span&gt;    &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;   &lt;span class=&quot;number&quot;&gt;608&lt;/span&gt;    &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;     &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;    &lt;span class=&quot;number&quot;&gt;542&lt;/span&gt;      &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt; --:--:--  &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;00&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;01&lt;/span&gt; --:--:--   &lt;span class=&quot;number&quot;&gt;543&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;     &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;    &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;     &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;    &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;     &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;      &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;      &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt; --:--:--  &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;02&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;08&lt;/span&gt; --:--:--     &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;curl: (&lt;span class=&quot;number&quot;&gt;7&lt;/span&gt;) Failed to connect to github-cloud.s3.amazonaws.com port &lt;span class=&quot;number&quot;&gt;443&lt;/span&gt;: Connection timed out&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;又是S3，看来又要把路由的全局番茄打开。&lt;/p&gt;
&lt;h3 id=&quot;修改配置文件&quot;&gt;&lt;a href=&quot;#修改配置文件&quot; class=&quot;headerlink&quot; title=&quot;修改配置文件&quot;&gt;&lt;/a&gt;修改配置文件&lt;/h3&gt;&lt;figure class=&quot;highlight cpp&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;preprocessor&quot;&gt;#  cluster/ubuntu/config-default.sh&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;export&lt;/span&gt; nodes=&lt;span class=&quot;string&quot;&gt;&quot;vcap@10.10.103.250 vcap@10.10.103.162 vcap@10.10.103.223&quot;&lt;/span&gt; &lt;span class=&quot;preprocessor&quot;&gt;#user@IP&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;preprocessor&quot;&gt;#export roles=&lt;span class=&quot;string&quot;&gt;&quot;ai i i&quot;&lt;/span&gt; # 这里需要注意 role和上面的nodes一一对应，也就是说&lt;span class=&quot;string&quot;&gt;&quot;第一个node对应第一个role，即ai，表示master+node&quot;&lt;/span&gt;，后面的i就表示是node&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;preprocessor&quot;&gt;#export NUM_MINIONS=$&amp;#123;NUM_MINIONS:-&lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;&amp;#125;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;preprocessor&quot;&gt;#export SERVICE_CLUSTER_IP_RANGE=&lt;span class=&quot;number&quot;&gt;192.168&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.1&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.0&lt;/span&gt;/&lt;span class=&quot;number&quot;&gt;16&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;preprocessor&quot;&gt;#export FLANNEL_NET=&lt;span class=&quot;number&quot;&gt;172.16&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.0&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.0&lt;/span&gt;/&lt;span class=&quot;number&quot;&gt;16&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;开始部署&quot;&gt;&lt;a href=&quot;#开始部署&quot; class=&quot;headerlink&quot; title=&quot;开始部署&quot;&gt;&lt;/a&gt;开始部署&lt;/h3&gt;&lt;figure class=&quot;highlight stata&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;/usr/&lt;span class=&quot;keyword&quot;&gt;local&lt;/span&gt;/kubernetes/&lt;span class=&quot;keyword&quot;&gt;cluster&lt;/span&gt;$ KUBERNETES_PROVIDER=ubuntu ./kube-up.&lt;span class=&quot;keyword&quot;&gt;sh&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;由于安装过程中老出错，再次部署的时候总提示文件被占用，服务正在运行，所以我写了个kill脚本，每次部署之前都kill一次&lt;/p&gt;
&lt;h3 id=&quot;部署完成&quot;&gt;&lt;a href=&quot;#部署完成&quot; class=&quot;headerlink&quot; title=&quot;部署完成&quot;&gt;&lt;/a&gt;部署完成&lt;/h3&gt;&lt;p&gt;部署完成之后&lt;br&gt;&lt;figure class=&quot;highlight cpp&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;kubectl get nodes&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;preprocessor&quot;&gt;# 显示&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;NAME            LABELS                                 STATUS    AGE&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;number&quot;&gt;192.168&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.1&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.148&lt;/span&gt;   kubernetes.io/hostname=&lt;span class=&quot;number&quot;&gt;192.168&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.1&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.148&lt;/span&gt;   Ready     &lt;span class=&quot;number&quot;&gt;6&lt;/span&gt;h&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;number&quot;&gt;192.168&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.1&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.173&lt;/span&gt;   kubernetes.io/hostname=&lt;span class=&quot;number&quot;&gt;192.168&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.1&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.173&lt;/span&gt;   Ready     &lt;span class=&quot;number&quot;&gt;6&lt;/span&gt;h&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;number&quot;&gt;192.168&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.1&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.241&lt;/span&gt;   kubernetes.io/hostname=&lt;span class=&quot;number&quot;&gt;192.168&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.1&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.241&lt;/span&gt;   Ready     &lt;span class=&quot;number&quot;&gt;6&lt;/span&gt;h&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;number&quot;&gt;192.168&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.1&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.245&lt;/span&gt;   kubernetes.io/hostname=&lt;span class=&quot;number&quot;&gt;192.168&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.1&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.245&lt;/span&gt;   Ready     &lt;span class=&quot;number&quot;&gt;6&lt;/span&gt;h&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h1 id=&quot;hello-world&quot;&gt;&lt;a href=&quot;#hello-world&quot; class=&quot;headerlink&quot; title=&quot;hello world&quot;&gt;&lt;/a&gt;hello world&lt;/h1&gt;&lt;p&gt;&lt;code&gt;本博客欢迎转发,但请保留原作者信息&lt;/code&gt;&lt;br&gt;github:&lt;a href=&quot;https://github.com/CodeJuan&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;codejuan&lt;/a&gt;&lt;br&gt;博客地址:&lt;a href=&quot;http://blog.decbug.com/&quot;&gt;http://blog.decbug.com/&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;背景&quot;&gt;&lt;a href=&quot;#背景&quot; class=&quot;headerlink&quot; title=&quot;背景&quot;&gt;&lt;/a&gt;背景&lt;/h1&gt;&lt;p&gt;需要做一个容器云，有同事在撸mesos+marathon+chronos，我就顺便折腾下kubernetes。&lt;br&gt;
    
    </summary>
    
      <category term="code" scheme="http://blog.decbug.com/categories/code/"/>
    
    
      <category term="docker" scheme="http://blog.decbug.com/tags/docker/"/>
    
      <category term="kubernetes" scheme="http://blog.decbug.com/tags/kubernetes/"/>
    
  </entry>
  
  <entry>
    <title>用go写的镜像构建微服务</title>
    <link href="http://blog.decbug.com/2016/02/17/go_image_build/"/>
    <id>http://blog.decbug.com/2016/02/17/go_image_build/</id>
    <published>2016-02-16T16:00:00.000Z</published>
    <updated>2016-06-29T13:21:22.619Z</updated>
    
    <content type="html">&lt;h1 id=&quot;功能&quot;&gt;&lt;a href=&quot;#功能&quot; class=&quot;headerlink&quot; title=&quot;功能&quot;&gt;&lt;/a&gt;功能&lt;/h1&gt;&lt;p&gt;前面已经把私有registry，镜像下载加速器(&lt;a href=&quot;http://docs.alauda.cn/feature/accelerator.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;摸我&lt;/a&gt;，其实就是基于registry官方镜像设置一个proxy，超级简单)完成了。&lt;br&gt;这个时候就可以提供类似Daoloud的代码构建功能啦&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;用户点击构建按钮（或是其他触发方式）&lt;/li&gt;
&lt;li&gt;我的镜像构建微服务收到请求后，就从内网github Clone代码&lt;/li&gt;
&lt;li&gt;在刚Clone代码里找到Dockerfile&lt;/li&gt;
&lt;li&gt;执行docker build -t &lt;code&gt;私有registry域名/用户名/镜像名：tag&lt;/code&gt; .&lt;/li&gt;
&lt;li&gt;docker push 刚build出来的镜像&lt;/li&gt;
&lt;li&gt;构建日志，构建结果，入库&lt;/li&gt;
&lt;li&gt;返回 &lt;code&gt;私有registry域名/用户名/镜像名：tag&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;用户就可以 pull &lt;code&gt;私有registry域名/用户名/镜像名：tag&lt;/code&gt; 啦&lt;br&gt;&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&quot;记录&quot;&gt;&lt;a href=&quot;#记录&quot; class=&quot;headerlink&quot; title=&quot;记录&quot;&gt;&lt;/a&gt;记录&lt;/h1&gt;&lt;p&gt;终于用go写完了一个类似DaoCloud自动构建镜像的微服务，一边google一边写，全程都是用Docker来开发的，收获还是挺大的，简单记录下。&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;基于golang1.5.3基础镜像，然后在代码里增加一个Godeps，把用到的库都放在Godeps，然后在Dockefile里r把Goeps加入到GOPATH环境变量&lt;/li&gt;
&lt;li&gt;参考了docker/distribution的Dockerfile，&lt;a href=&quot;https://github.com/CodeJuan/distribution/blob/master/Dockerfile&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://github.com/CodeJuan/distribution/blob/master/Dockerfile&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;由于只提供restful，就用的gorilla/mux框架&lt;/li&gt;
&lt;li&gt;数据库MySQL，orm用的是gorm&lt;/li&gt;
&lt;li&gt;用到了sync,crypt等库&lt;/li&gt;
&lt;li&gt;在docker内使用宿主机docker daemon的方法&lt;ul&gt;
&lt;li&gt;RUN (wget “&lt;a href=&quot;https://get.docker.com/builds/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://get.docker.com/builds/&lt;/a&gt;…” -O /usr/bin/docker &amp;amp;&amp;amp;\&lt;/li&gt;
&lt;li&gt;chmod +x /usr/bin/docker)&lt;/li&gt;
&lt;li&gt;然后再启动的时候指定/var/run/docker.sock:/var/run/docker.sock&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;开发测试部署都是用的Docker，数据库也是Docker。大概流程是&lt;ul&gt;
&lt;li&gt;修改代码，build我的微服务镜像，push到我的私有registry&lt;/li&gt;
&lt;li&gt;docker-compose从私有registry获取刚build的镜像，由于link了MySQL，就会先启动MySQL。&lt;/li&gt;
&lt;li&gt;接下来自动跑测试，我用的是python给我的微服务发post get等等。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;后续计划&lt;ul&gt;
&lt;li&gt;自动测试的脚本要加上从数据库里获取结果，与我的期望值进行比对。目前还是人肉比对，有些慢&lt;/li&gt;
&lt;li&gt;jenkins自动触发，有代码上了库就自动拉下来完成打镜像，推镜像，拉镜像，compse up，测试的一系列操作&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;p&gt;&lt;code&gt;本博客欢迎转发,但请保留原作者信息&lt;/code&gt;&lt;br&gt;github:&lt;a href=&quot;https://github.com/CodeJuan&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;codejuan&lt;/a&gt;&lt;br&gt;博客地址:&lt;a href=&quot;http://blog.decbug.com/&quot;&gt;http://blog.decbug.com/&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;功能&quot;&gt;&lt;a href=&quot;#功能&quot; class=&quot;headerlink&quot; title=&quot;功能&quot;&gt;&lt;/a&gt;功能&lt;/h1&gt;&lt;p&gt;前面已经把私有registry，镜像下载加速器(&lt;a href=&quot;http://docs.alauda.cn/feature/accelerator.html&quot;&gt;摸我&lt;/a&gt;，其实就是基于registry官方镜像设置一个proxy，超级简单)完成了。&lt;br&gt;这个时候就可以提供类似Daoloud的代码构建功能啦&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;用户点击构建按钮（或是其他触发方式）&lt;/li&gt;
&lt;li&gt;我的镜像构建微服务收到请求后，就从内网github Clone代码&lt;/li&gt;
&lt;li&gt;在刚Clone代码里找到Dockerfile&lt;/li&gt;
&lt;li&gt;执行docker build -t &lt;code&gt;私有registry域名/用户名/镜像名：tag&lt;/code&gt; .&lt;/li&gt;
&lt;li&gt;docker push 刚build出来的镜像&lt;/li&gt;
&lt;li&gt;构建日志，构建结果，入库&lt;/li&gt;
&lt;li&gt;返回 &lt;code&gt;私有registry域名/用户名/镜像名：tag&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;用户就可以 pull &lt;code&gt;私有registry域名/用户名/镜像名：tag&lt;/code&gt; 啦&lt;br&gt;
    
    </summary>
    
      <category term="code" scheme="http://blog.decbug.com/categories/code/"/>
    
    
      <category term="docker" scheme="http://blog.decbug.com/tags/docker/"/>
    
      <category term="golang" scheme="http://blog.decbug.com/tags/golang/"/>
    
      <category term="microservice" scheme="http://blog.decbug.com/tags/microservice/"/>
    
  </entry>
  
  <entry>
    <title>分布式消息系统架构图</title>
    <link href="http://blog.decbug.com/2016/02/01/msg_arch/"/>
    <id>http://blog.decbug.com/2016/02/01/msg_arch/</id>
    <published>2016-01-31T17:00:00.000Z</published>
    <updated>2016-06-29T13:21:22.619Z</updated>
    
    <content type="html">&lt;h1 id=&quot;哈哈哈&quot;&gt;&lt;a href=&quot;#哈哈哈&quot; class=&quot;headerlink&quot; title=&quot;哈哈哈&quot;&gt;&lt;/a&gt;哈哈哈&lt;/h1&gt;&lt;p&gt;手画的架构图&lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;p&gt;&lt;img src=&quot;https://github.com/CodeJuan/codejuan.github.io/raw/master/images/blog/architecture.jpg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;&lt;code&gt;本博客欢迎转发,但请保留原作者信息&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;github:&lt;a href=&quot;https://github.com/CodeJuan&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;codejuan&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;博客地址:&lt;a href=&quot;http://blog.decbug.com/&quot;&gt;http://blog.decbug.com/&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;哈哈哈&quot;&gt;&lt;a href=&quot;#哈哈哈&quot; class=&quot;headerlink&quot; title=&quot;哈哈哈&quot;&gt;&lt;/a&gt;哈哈哈&lt;/h1&gt;&lt;p&gt;手画的架构图&lt;/p&gt;
    
    </summary>
    
      <category term="code" scheme="http://blog.decbug.com/categories/code/"/>
    
    
      <category term="architecture" scheme="http://blog.decbug.com/tags/architecture/"/>
    
  </entry>
  
  <entry>
    <title>2016学习计划</title>
    <link href="http://blog.decbug.com/2016/01/31/planning2016/"/>
    <id>http://blog.decbug.com/2016/01/31/planning2016/</id>
    <published>2016-01-30T16:00:00.000Z</published>
    <updated>2016-06-29T13:21:22.619Z</updated>
    
    <content type="html">&lt;p&gt;总觉得今天才是2015的最后一天，那么就计划一下2016吧&lt;br&gt;&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&quot;英语&quot;&gt;&lt;a href=&quot;#英语&quot; class=&quot;headerlink&quot; title=&quot;英语&quot;&gt;&lt;/a&gt;英语&lt;/h1&gt;&lt;ol&gt;
&lt;li&gt;每天10个单词，要求能造句&lt;/li&gt;
&lt;li&gt;每天一篇技术文章，要求能复述&lt;/li&gt;
&lt;li&gt;继续每天一篇听力&lt;/li&gt;
&lt;li&gt;要多开口说了，2015说的太少&lt;/li&gt;
&lt;li&gt;已经可以在github上和&lt;code&gt;第一语言是英语的同僚&lt;/code&gt;对话了，接下来要尝试用英文写博客&lt;/li&gt;
&lt;/ol&gt;
&lt;h1 id=&quot;代码&quot;&gt;&lt;a href=&quot;#代码&quot; class=&quot;headerlink&quot; title=&quot;代码&quot;&gt;&lt;/a&gt;代码&lt;/h1&gt;&lt;ol&gt;
&lt;li&gt;虽然我很讨厌架构师这个头衔，因为太多嘴炮架构师，啥都不会光会吹。但是有时候为了展示自己的实力，不得不给自己也挂上&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;…..&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;&lt;code&gt;本博客欢迎转发,但请保留原作者信息&lt;/code&gt;&lt;br&gt;github:&lt;a href=&quot;https://github.com/CodeJuan&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;codejuan&lt;/a&gt;&lt;br&gt;博客地址:&lt;a href=&quot;http://blog.decbug.com/&quot;&gt;http://blog.decbug.com/&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;总觉得今天才是2015的最后一天，那么就计划一下2016吧&lt;br&gt;
    
    </summary>
    
      <category term="planning" scheme="http://blog.decbug.com/categories/planning/"/>
    
    
      <category term="career" scheme="http://blog.decbug.com/tags/career/"/>
    
  </entry>
  
</feed>
